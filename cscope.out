cscope 15 /work_base/Riscv-FreeRTOS10V -q 0000000691 0000071054
	@Common/include/FreeRTOS.h

1 
	#pÜtYIELD_WITHIN_API
 
pÜtYIELD


	)

2 
	#pÜtYIELD
(è
	`vPÜtY›ld
()

	)

	@Common/include/common.h

1 
	#pÜtMAX_DELAY
 ( 
TickTy³_t
 ) 0xffffffffUL

	)

2 
	tUBa£Ty³_t
;

3 
ušt32_t
 
	tTickTy³_t
;

4 
	#št8_t
 

	)

5 
	#ušt8_t
 

	)

6 
	#ušt16_t
 

	)

7 
	#ušt32_t
 

	)

8 
	#ušt64_t
 

	)

9 
	tBa£Ty³_t
;

11 
	#SckTy³_t
 
ušt32_t


	)

12 
	#pÜtPRIVILEGE_BIT
 ( ( 
UBa£Ty³_t
 ) 0x00 )

	)

13 
	#pdFALSE
 
çl£


	)

14 
	#pdTRUE
 
Œue


	)

15 
	#pdPASS
 ( 
pdTRUE
 )

	)

17 
	#size_t
 

	)

18 
	#cÚfigMAX_PRIORITIES
 ( 30 )

	)

19 
	#pÜtPOINTER_SIZE_TYPE
 

	)

20 
	#cÚfigMAX_TASK_NAME_LEN
 ( 16 )

	)

21 
	#cÚfigINITIAL_TICK_COUNT
 0

	)

22 
	#”rCOULD_NOT_ALLOCATE_REQUIRED_MEMORY
 ( -1 )

	)

23 
	#pÜtTASK_FUNCTION
Ğ
vFunùiÚ
, 
pvP¬am‘”s
 ) 
	`vFunùiÚ
Ğ*pvP¬am‘” )

	)

	@Common/include/list.h

1 #iâdeà
LIST_H


2 
	#LIST_H


	)

4 #iâdeà
cÚfigLIST_VOLATILE


5 
	#cÚfigLIST_VOLATILE


	)

9 #ifdeà
__ılu¥lus


13 
	#li¡FIRST_LIST_ITEM_INTEGRITY_CHECK_VALUE


	)

14 
	#li¡SECOND_LIST_ITEM_INTEGRITY_CHECK_VALUE


	)

20 
xLIST
;

21 
	sxLIST_ITEM


23 
li¡FIRST_LIST_ITEM_INTEGRITY_CHECK_VALUE


24 
cÚfigLIST_VOLATILE
 
TickTy³_t
 
xI‹mV®ue
;

25 
xLIST_ITEM
 * 
cÚfigLIST_VOLATILE
 
pxNext
;

26 
xLIST_ITEM
 * 
cÚfigLIST_VOLATILE
 
pxP»vious
;

27 * 
pvOwÃr
;

28 
xLIST
 * 
cÚfigLIST_VOLATILE
 
pxCÚš”
;

29 
li¡SECOND_LIST_ITEM_INTEGRITY_CHECK_VALUE


31 
xLIST_ITEM
 
	tLi¡I‹m_t
;

33 
	sxMINI_LIST_ITEM


35 
li¡FIRST_LIST_ITEM_INTEGRITY_CHECK_VALUE


36 
cÚfigLIST_VOLATILE
 
TickTy³_t
 
xI‹mV®ue
;

37 
xLIST_ITEM
 * 
cÚfigLIST_VOLATILE
 
pxNext
;

38 
xLIST_ITEM
 * 
cÚfigLIST_VOLATILE
 
pxP»vious
;

40 
xMINI_LIST_ITEM
 
	tMšiLi¡I‹m_t
;

45 
	sxLIST


47 vŞ©
UBa£Ty³_t
 
uxNumb”OfI‹ms
;

48 
Li¡I‹m_t
 * 
cÚfigLIST_VOLATILE
 
pxIndex
;

49 
MšiLi¡I‹m_t
 
xLi¡End
;

50 } 
	tLi¡_t
;

53 
	#li¡SET_LIST_ITEM_OWNER
Ğ
pxLi¡I‹m
, 
pxOwÃr
 ) ( (…xLi¡I‹m )->
pvOwÃr
 = ( * ) (…xOwÃ¸è)

	)

55 
	#li¡GET_LIST_ITEM_OWNER
Ğ
pxLi¡I‹m
 ) ( (…xLi¡I‹m )->
pvOwÃr
 )

	)

57 
	#li¡SET_LIST_ITEM_VALUE
Ğ
pxLi¡I‹m
, 
xV®ue
 ) ( (…xLi¡I‹m )->
xI‹mV®ue
 = ( xV®uè)

	)

59 
	#li¡GET_LIST_ITEM_VALUE
Ğ
pxLi¡I‹m
 ) ( (…xLi¡I‹m )->
xI‹mV®ue
 )

	)

61 
	#li¡GET_ITEM_VALUE_OF_HEAD_ENTRY
Ğ
pxLi¡
 ) ( ( (…xLi¡ )->
xLi¡End
 ).
pxNext
->
xI‹mV®ue
 )

	)

63 
	#li¡GET_HEAD_ENTRY
Ğ
pxLi¡
 ) ( ( (…xLi¡ )->
xLi¡End
 ).
pxNext
 )

	)

65 
	#li¡GET_NEXT
Ğ
pxLi¡I‹m
 ) ( (…xLi¡I‹m )->
pxNext
 )

	)

67 
	#li¡GET_END_MARKER
Ğ
pxLi¡
 ) ( ( 
Li¡I‹m_t
 cÚ¡ * ) ( &ĞĞpxLi¡ )->
xLi¡End
 ) ) )

	)

69 
	#li¡LIST_IS_EMPTY
Ğ
pxLi¡
 ) ( ( (…xLi¡ )->
uxNumb”OfI‹ms
 =ğĞ
UBa£Ty³_t
 ) 0 ) ? 
pdTRUE
 : 
pdFALSE
 )

	)

71 
	#li¡CURRENT_LIST_LENGTH
Ğ
pxLi¡
 ) ( (…xLi¡ )->
uxNumb”OfI‹ms
 )

	)

73 
	#li¡GET_OWNER_OF_NEXT_ENTRY
Ğ
pxTCB
, 
pxLi¡
 ) \

75 
Li¡_t
 * cÚ¡ 
pxCÚ¡Li¡
 = ( 
pxLi¡
 ); \

78 Ğ
pxCÚ¡Li¡
 )->
pxIndex
 = (…xCÚ¡Li¡ )->pxIndex->
pxNext
; \

79 ifĞĞ* ) ( 
pxCÚ¡Li¡
 )->
pxIndex
 =ğĞ* ) &ĞĞpxCÚ¡Li¡ )->
xLi¡End
 ) ) \

81 Ğ
pxCÚ¡Li¡
 )->
pxIndex
 = (…xCÚ¡Li¡ )->pxIndex->
pxNext
; \

83 Ğ
pxTCB
 ) = ( 
pxCÚ¡Li¡
 )->
pxIndex
->
pvOwÃr
; \

84 }

	)

87 
	#li¡GET_OWNER_OF_HEAD_ENTRY
Ğ
pxLi¡
 ) ( ( &ĞĞpxLi¡ )->
xLi¡End
 ) )->
pxNext
->
pvOwÃr
 )

	)

89 
	#li¡IS_CONTAINED_WITHIN
Ğ
pxLi¡
, 
pxLi¡I‹m
 ) ( ( (…xLi¡I‹m )->
pxCÚš”
 =ğĞpxLi¡ ) ) ? ( 
pdTRUE
 ) : ( 
pdFALSE
 ) )

	)

91 
	#li¡LIST_ITEM_CONTAINER
Ğ
pxLi¡I‹m
 ) ( (…xLi¡I‹m )->
pxCÚš”
 )

	)

93 
	#li¡LIST_IS_INITIALISED
Ğ
pxLi¡
 ) ( (…xLi¡ )->
xLi¡End
.
xI‹mV®ue
 =ğ
pÜtMAX_DELAY
 )

	)

95 
vLi¡In™Ÿli£
Ğ
Li¡_t
 * cÚ¡ 
pxLi¡
 ) 
PRIVILEGED_FUNCTION
;

97 
vLi¡In™Ÿli£I‹m
Ğ
Li¡I‹m_t
 * cÚ¡ 
pxI‹m
 ) 
PRIVILEGED_FUNCTION
;

100 
vLi¡In£¹
Ğ
Li¡_t
 * cÚ¡ 
pxLi¡
,

101 
Li¡I‹m_t
 * cÚ¡ 
pxNewLi¡I‹m
 ) 
PRIVILEGED_FUNCTION
;

103 
vLi¡In£¹End
Ğ
Li¡_t
 * cÚ¡ 
pxLi¡
,

104 
Li¡I‹m_t
 * cÚ¡ 
pxNewLi¡I‹m
 ) 
PRIVILEGED_FUNCTION
;

106 
UBa£Ty³_t
 
uxLi¡Remove
Ğ
Li¡I‹m_t
 * cÚ¡ 
pxI‹mToRemove
 ) 
PRIVILEGED_FUNCTION
;

108 #ifdeà
__ılu¥lus


	@Common/include/queue.h

1 #iâdeà
QUEUE_H


2 
	#QUEUE_H


	)

4 
	#queueYIELD_IF_USING_PREEMPTION
(è
	`pÜtYIELD_WITHIN_API
()

	)

5 
	gQueueDefš™iÚ
;

6 
QueueDefš™iÚ
 * 
	tQueueHªdË_t
;

8 
QueueDefš™iÚ
 * 
	tQueueS‘HªdË_t
;

10 
QueueDefš™iÚ
 * 
	tQueueS‘Memb”HªdË_t
;

13 
	#queueSEND_TO_BACK
 ( ( 
Ba£Ty³_t
 ) 0 )

	)

14 
	#queueSEND_TO_FRONT
 ( ( 
Ba£Ty³_t
 ) 1 )

	)

15 
	#queueOVERWRITE
 ( ( 
Ba£Ty³_t
 ) 2 )

	)

18 
	#queueQUEUE_TYPE_BASE
 ( ( 
ušt8_t
 ) 0U )

	)

19 
	#queueQUEUE_TYPE_SET
 ( ( 
ušt8_t
 ) 0U )

	)

20 
	#queueQUEUE_TYPE_MUTEX
 ( ( 
ušt8_t
 ) 1U )

	)

21 
	#queueQUEUE_TYPE_COUNTING_SEMAPHORE
 ( ( 
ušt8_t
 ) 2U )

	)

22 
	#queueQUEUE_TYPE_BINARY_SEMAPHORE
 ( ( 
ušt8_t
 ) 3U )

	)

23 
	#queueQUEUE_TYPE_RECURSIVE_MUTEX
 ( ( 
ušt8_t
 ) 4U )

	)

25 
	#xQueueC»©e
Ğ
uxQueueL’gth
, 
uxI‹mSize
 ) 
	`xQueueG’”icC»©e
ĞĞuxQueueL’gth ), ( uxI‹mSiz), ( 
queueQUEUE_TYPE_BASE
 ) )

	)

28 
	#xQueueS’dToFrÚt
Ğ
xQueue
, 
pvI‹mToQueue
, 
xTicksToWa™
 ) \

29 
	`xQueueG’”icS’d
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), ( 
xTicksToWa™
 ), 
queueSEND_TO_FRONT
 )

	)

32 
	#xQueueS’dToBack
Ğ
xQueue
, 
pvI‹mToQueue
, 
xTicksToWa™
 ) \

33 
	`xQueueG’”icS’d
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), ( 
xTicksToWa™
 ), 
queueSEND_TO_BACK
 )

	)

36 
	#xQueueS’d
Ğ
xQueue
, 
pvI‹mToQueue
, 
xTicksToWa™
 ) \

37 
	`xQueueG’”icS’d
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), ( 
xTicksToWa™
 ), 
queueSEND_TO_BACK
 )

	)

39 
	#xQueueOv”wr™e
Ğ
xQueue
, 
pvI‹mToQueue
 ) \

40 
	`xQueueG’”icS’d
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), 0, 
queueOVERWRITE
 )

	)

42 
Ba£Ty³_t
 
	$xQueueG’”icS’d
Ğ
QueueHªdË_t
 
xQueue
,

43 cÚ¡ * cÚ¡ 
pvI‹mToQueue
,

44 
TickTy³_t
 
xTicksToWa™
,

45 cÚ¡ 
Ba£Ty³_t
 
xCİyPos™iÚ
 ) 
PRIVILEGED_FUNCTION
;

47 
Ba£Ty³_t
 
	$xQueueP“k
Ğ
QueueHªdË_t
 
xQueue
,

48 * cÚ¡ 
pvBufãr
,

49 
TickTy³_t
 
xTicksToWa™
 ) 
PRIVILEGED_FUNCTION
;

51 
Ba£Ty³_t
 
	$xQueueP“kFromISR
Ğ
QueueHªdË_t
 
xQueue
,

52 * cÚ¡ 
pvBufãr
 ) 
PRIVILEGED_FUNCTION
;

54 
Ba£Ty³_t
 
	$xQueueReûive
Ğ
QueueHªdË_t
 
xQueue
,

55 * cÚ¡ 
pvBufãr
,

56 
TickTy³_t
 
xTicksToWa™
 ) 
PRIVILEGED_FUNCTION
;

58 
UBa£Ty³_t
 
	$uxQueueMes§gesWa™šg
ĞcÚ¡ 
QueueHªdË_t
 
xQueue
 ) 
PRIVILEGED_FUNCTION
;

60 
	$vQueueD–‘e
Ğ
QueueHªdË_t
 
xQueue
 ) 
PRIVILEGED_FUNCTION
;

63 
	#xQueueS’dToFrÚtFromISR
Ğ
xQueue
, 
pvI‹mToQueue
, 
pxHigh”PriÜ™yTaskWok’
 ) \

64 
	`xQueueG’”icS’dFromISR
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), ( 
pxHigh”PriÜ™yTaskWok’
 ), 
queueSEND_TO_FRONT
 )

	)

66 
	#xQueueS’dToBackFromISR
Ğ
xQueue
, 
pvI‹mToQueue
, 
pxHigh”PriÜ™yTaskWok’
 ) \

67 
	`xQueueG’”icS’dFromISR
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), ( 
pxHigh”PriÜ™yTaskWok’
 ), 
queueSEND_TO_BACK
 )

	)

69 
	#xQueueS’dFromISR
Ğ
xQueue
, 
pvI‹mToQueue
, 
pxHigh”PriÜ™yTaskWok’
 ) \

70 
	`xQueueG’”icS’dFromISR
ĞĞ
xQueue
 ), ( 
pvI‹mToQueue
 ), ( 
pxHigh”PriÜ™yTaskWok’
 ), 
queueSEND_TO_BACK
 )

	)

72 
Ba£Ty³_t
 
	$xQueueG’”icS’dFromISR
Ğ
QueueHªdË_t
 
xQueue
,

73 cÚ¡ * cÚ¡ 
pvI‹mToQueue
,

74 
Ba£Ty³_t
 * cÚ¡ 
pxHigh”PriÜ™yTaskWok’
,

75 cÚ¡ 
Ba£Ty³_t
 
xCİyPos™iÚ
 ) 
PRIVILEGED_FUNCTION
;

76 
Ba£Ty³_t
 
	$xQueueGiveFromISR
Ğ
QueueHªdË_t
 
xQueue
,

77 
Ba£Ty³_t
 * cÚ¡ 
pxHigh”PriÜ™yTaskWok’
 ) 
PRIVILEGED_FUNCTION
;

80 
	$vQueueAddToRegi¡ry
Ğ
QueueHªdË_t
 
xQueue
,

81 cÚ¡ * 
pcQueueName
 ) 
PRIVILEGED_FUNCTION
;

84 
QueueHªdË_t
 
	$xQueueG’”icC»©e
ĞcÚ¡ 
UBa£Ty³_t
 
uxQueueL’gth
,

85 cÚ¡ 
UBa£Ty³_t
 
uxI‹mSize
,

86 cÚ¡ 
ušt8_t
 
ucQueueTy³
 ) 
PRIVILEGED_FUNCTION
;

	@Common/src/list.c

1 
	~<li¡.h
>

2 
	~<commÚ.h
>

4 
	$vLi¡In™Ÿli£
Ğ
Li¡_t
 * cÚ¡ 
pxLi¡
 )

9 
pxLi¡
->
pxIndex
 = ( 
Li¡I‹m_t
 * ) &ĞpxLi¡->
xLi¡End
 );

13 
pxLi¡
->
xLi¡End
.
xI‹mV®ue
 = 
pÜtMAX_DELAY
;

17 
pxLi¡
->
xLi¡End
.
pxNext
 = ( 
Li¡I‹m_t
 * ) &(…xList->xListEnd );

18 
pxLi¡
->
xLi¡End
.
pxP»vious
 = ( 
Li¡I‹m_t
 * ) &(…xList->xListEnd );

20 
pxLi¡
->
uxNumb”OfI‹ms
 = ( 
UBa£Ty³_t
 ) 0U;

24 
	}
}

29 
	$vLi¡In™Ÿli£I‹m
Ğ
Li¡I‹m_t
 * cÚ¡ 
pxI‹m
 )

32 
pxI‹m
->
pxCÚš”
 = 
NULL
;

36 
	}
}

39 
	$vLi¡In£¹End
Ğ
Li¡_t
 * cÚ¡ 
pxLi¡
,

40 
Li¡I‹m_t
 * cÚ¡ 
pxNewLi¡I‹m
 )

42 
Li¡I‹m_t
 * cÚ¡ 
pxIndex
 = 
pxLi¡
->pxIndex;

48 
pxNewLi¡I‹m
->
pxNext
 = 
pxIndex
;

49 
pxNewLi¡I‹m
->
pxP»vious
 = 
pxIndex
->pxPrevious;

52 
pxIndex
->
pxP»vious
->
pxNext
 = 
pxNewLi¡I‹m
;

53 
pxIndex
->
pxP»vious
 = 
pxNewLi¡I‹m
;

56 
pxNewLi¡I‹m
->
pxCÚš”
 = 
pxLi¡
;

58 Ğ
pxLi¡
->
uxNumb”OfI‹ms
 )++;

59 
	}
}

61 
	$vLi¡In£¹
Ğ
Li¡_t
 * cÚ¡ 
pxLi¡
,

62 
Li¡I‹m_t
 * cÚ¡ 
pxNewLi¡I‹m
 )

64 
Li¡I‹m_t
 * 
pxI‹¿tÜ
;

65 cÚ¡ 
TickTy³_t
 
xV®ueOfIn£¹iÚ
 = 
pxNewLi¡I‹m
->
xI‹mV®ue
;

76 ifĞ
xV®ueOfIn£¹iÚ
 =ğ
pÜtMAX_DELAY
 )

78 
pxI‹¿tÜ
 = 
pxLi¡
->
xLi¡End
.
pxP»vious
;

82  
pxI‹¿tÜ
 = ( 
Li¡I‹m_t
 * ) &Ğ
pxLi¡
->
xLi¡End
 );…xI‹¿tÜ->
pxNext
->
xI‹mV®ue
 <ğ
xV®ueOfIn£¹iÚ
;…xIterator =…xIterator->pxNext )

89 
pxNewLi¡I‹m
->
pxNext
 = 
pxI‹¿tÜ
->pxNext;

90 
pxNewLi¡I‹m
->
pxNext
->
pxP»vious
 =…xNewListItem;

91 
pxNewLi¡I‹m
->
pxP»vious
 = 
pxI‹¿tÜ
;

92 
pxI‹¿tÜ
->
pxNext
 = 
pxNewLi¡I‹m
;

94 
pxNewLi¡I‹m
->
pxCÚš”
 = 
pxLi¡
;

96 Ğ
pxLi¡
->
uxNumb”OfI‹ms
 )++;

98 
	}
}

102 
UBa£Ty³_t
 
	$uxLi¡Remove
Ğ
Li¡I‹m_t
 * cÚ¡ 
pxI‹mToRemove
 )

106 
Li¡_t
 * cÚ¡ 
pxLi¡
 = 
pxI‹mToRemove
->
pxCÚš”
;

108 
pxI‹mToRemove
->
pxNext
->
pxP»vious
 =…xItemToRemove->pxPrevious;

109 
pxI‹mToRemove
->
pxP»vious
->
pxNext
 =…xItemToRemove->pxNext;

114 ifĞ
pxLi¡
->
pxIndex
 =ğ
pxI‹mToRemove
 )

116 
pxLi¡
->
pxIndex
 = 
pxI‹mToRemove
->
pxP»vious
;

120 
pxI‹mToRemove
->
pxCÚš”
 = 
NULL
;

121 Ğ
pxLi¡
->
uxNumb”OfI‹ms
 )--;

123  
pxLi¡
->
uxNumb”OfI‹ms
;

124 
	}
}

	@Common/src/queue.c

1 
	~<queue.h
>

2 
	~<commÚ.h
>

3 
	sQueuePoš‹rs


5 
št8_t
 * 
	mpcTa
;

6 
št8_t
 * 
	mpcR—dFrom
;

7 } 
	tQueuePoš‹rs_t
;

9 
	sSem­hÜeD©a


11 
TaskHªdË_t
 
	mxMu‹xHŞd”
;

12 
UBa£Ty³_t
 
	muxRecursiveC®lCouÁ
;

13 } 
	tSem­hÜeD©a_t
;

16 
	sQueueDefš™iÚ


18 
št8_t
 * 
	mpcH—d
;

19 
št8_t
 * 
	mpcWr™eTo
;

23 
QueuePoš‹rs_t
 
	mxQueue
;

24 
Sem­hÜeD©a_t
 
	mxSem­hÜe
;

25 } 
	mu
;

27 
Li¡_t
 
	mxTasksWa™šgToS’d
;

28 
Li¡_t
 
	mxTasksWa™šgToReûive
;

30 vŞ©
UBa£Ty³_t
 
	muxMes§gesWa™šg
;

31 
UBa£Ty³_t
 
	muxL’gth
;

32 
UBa£Ty³_t
 
	muxI‹mSize
;

34 vŞ©
št8_t
 
	mcRxLock
;

35 vŞ©
št8_t
 
	mcTxLock
;

37 #iàĞĞ
cÚfigSUPPORT_STATIC_ALLOCATION
 =ğ1 ) && ( 
cÚfigSUPPORT_DYNAMIC_ALLOCATION
 == 1 ) )

38 
ušt8_t
 
	mucStiÿÎyAÎoÿ‹d
;

41 #iàĞ
cÚfigUSE_QUEUE_SETS
 == 1 )

42 
QueueDefš™iÚ
 * 
	mpxQueueS‘CÚš”
;

45 #iàĞ
cÚfigUSE_TRACE_FACILITY
 == 1 )

46 
UBa£Ty³_t
 
	muxQueueNumb”
;

47 
ušt8_t
 
	mucQueueTy³
;

49 } 
	txQUEUE
;

51 
	#queueYIELD_IF_USING_PREEMPTION
(è
	`pÜtYIELD_WITHIN_API
()

	)

56 
xQUEUE
 
	tQueue_t
;

58 
´vCİyD©aFromQueue
Ğ
Queue_t
 * cÚ¡ 
pxQueue
,* cÚ¡ 
pvBufãr
 );

59 
Ba£Ty³_t
 
´vCİyD©aToQueue
Ğ
Queue_t
 * cÚ¡ 
pxQueue
,cÚ¡ * 
pvI‹mToQueue
,cÚ¡ Ba£Ty³_ˆ
xPos™iÚ
 );

60 
´vIn™Ÿli£NewQueue
ĞcÚ¡ 
UBa£Ty³_t
 
uxQueueL’gth
,cÚ¡ UBa£Ty³_ˆ
uxI‹mSize
,
ušt8_t
 * 
pucQueueStÜage
,cÚ¡ ušt8_ˆ
ucQueueTy³
,
Queue_t
 * 
pxNewQueue
 );

61 
Ba£Ty³_t
 
´vIsQueueEm±y
ĞcÚ¡ 
Queue_t
 * 
pxQueue
 );

62 
Ba£Ty³_t
 
´vIsQueueFuÎ
ĞcÚ¡ 
Queue_t
 * 
pxQueue
 );

63 
QueueHªdË_t
 
xQueueG’”icC»©e
ĞcÚ¡ 
UBa£Ty³_t
 
uxQueueL’gth
,cÚ¡ UBa£Ty³_ˆ
uxI‹mSize
,cÚ¡ 
ušt8_t
 
ucQueueTy³
 );

64 
Ba£Ty³_t
 
xQueueG’”icRe£t
Ğ
QueueHªdË_t
 
xQueue
,Ba£Ty³_ˆ
xNewQueue
 );

65 
Ba£Ty³_t
 
xQueueG’”icS’d
Ğ
QueueHªdË_t
 
xQueue
,cÚ¡ * cÚ¡ 
pvI‹mToQueue
,
TickTy³_t
 
xTicksToWa™
,cÚ¡ Ba£Ty³_ˆ
xCİyPos™iÚ
 );

66 
Ba£Ty³_t
 
xQueueReûive
Ğ
QueueHªdË_t
 
xQueue
,* cÚ¡ 
pvBufãr
,
TickTy³_t
 
xTicksToWa™
 );

68 
Ba£Ty³_t
 
	$xQueueG’”icRe£t
Ğ
QueueHªdË_t
 
xQueue
,

69 
Ba£Ty³_t
 
xNewQueue
 )

71 
Queue_t
 * cÚ¡ 
pxQueue
 = 
xQueue
;

74 
	`skENTER_CRITICAL
();

76 
pxQueue
->
u
.
xQueue
.
pcTa
 =…xQueue->
pcH—d
 + (…xQueue->
uxL’gth
 *…xQueue->
uxI‹mSize
 );

77 
pxQueue
->
uxMes§gesWa™šg
 = ( 
UBa£Ty³_t
 ) 0U;

78 
pxQueue
->
pcWr™eTo
 =…xQueue->
pcH—d
;

79 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 =…xQueue->
pcH—d
 + ( (…xQueue->
uxL’gth
 - 1U ) *…xQueue->
uxI‹mSize
 );

80 
pxQueue
->
cRxLock
 = 
queueUNLOCKED
;

81 
pxQueue
->
cTxLock
 = 
queueUNLOCKED
;

83 ifĞ
xNewQueue
 =ğ
pdFALSE
 )

90 ifĞ
	`li¡LIST_IS_EMPTY
Ğ&Ğ
pxQueue
->
xTasksWa™šgToS’d
 ) ) =ğ
pdFALSE
 )

92 ifĞ
	`xTaskRemoveFromEv’tLi¡
Ğ&Ğ
pxQueue
->
xTasksWa™šgToS’d
 ) ) !ğ
pdFALSE
 )

94 
	`queueYIELD_IF_USING_PREEMPTION
();

102 
	`vLi¡In™Ÿli£
Ğ&Ğ
pxQueue
->
xTasksWa™šgToS’d
 ) );

103 
	`vLi¡In™Ÿli£
Ğ&Ğ
pxQueue
->
xTasksWa™šgToReûive
 ) );

109  
pdPASS
;

110 
	}
}

112 
	$´vIn™Ÿli£NewQueue
ĞcÚ¡ 
UBa£Ty³_t
 
uxQueueL’gth
,

113 cÚ¡ 
UBa£Ty³_t
 
uxI‹mSize
,

114 
ušt8_t
 * 
pucQueueStÜage
,

115 cÚ¡ 
ušt8_t
 
ucQueueTy³
,

116 
Queue_t
 * 
pxNewQueue
 )

120 Ğè
ucQueueTy³
;

122 ifĞ
uxI‹mSize
 =ğĞ
UBa£Ty³_t
 ) 0 )

128 
pxNewQueue
->
pcH—d
 = ( 
št8_t
 * )…xNewQueue;

133 
pxNewQueue
->
pcH—d
 = ( 
št8_t
 * ) 
pucQueueStÜage
;

138 
pxNewQueue
->
uxL’gth
 = 
uxQueueL’gth
;

139 
pxNewQueue
->
uxI‹mSize
 = uxItemSize;

140 Ğè
	`xQueueG’”icRe£t
Ğ
pxNewQueue
, 
pdTRUE
 );

142 #iàĞ
cÚfigUSE_TRACE_FACILITY
 == 1 )

144 
pxNewQueue
->
ucQueueTy³
 = ucQueueType;

148 #iàĞ
cÚfigUSE_QUEUE_SETS
 == 1 )

150 
pxNewQueue
->
pxQueueS‘CÚš”
 = 
NULL
;

154 
	}
}

156 
QueueHªdË_t
 
	$xQueueG’”icC»©e
ĞcÚ¡ 
UBa£Ty³_t
 
uxQueueL’gth
,

157 cÚ¡ 
UBa£Ty³_t
 
uxI‹mSize
,

158 cÚ¡ 
ušt8_t
 
ucQueueTy³
 )

160 
Queue_t
 * 
pxNewQueue
;

161 
size_t
 
xQueueSizeInBy‹s
;

162 
ušt8_t
 * 
pucQueueStÜage
;

168 
xQueueSizeInBy‹s
 = ( 
size_t
 ) ( 
uxQueueL’gth
 * 
uxI‹mSize
 );

180 
pxNewQueue
 = ( 
Queue_t
 * ) 
	`pvPÜtM®loc
ĞĞQueue_ˆè+ 
xQueueSizeInBy‹s
 );

182 ifĞ
pxNewQueue
 !ğ
NULL
 )

186 
pucQueueStÜage
 = ( 
ušt8_t
 * ) 
pxNewQueue
;

187 
pucQueueStÜage
 +ğĞ
Queue_t
 );

189 #iàĞ
cÚfigSUPPORT_STATIC_ALLOCATION
 == 1 )

194 
pxNewQueue
->
ucStiÿÎyAÎoÿ‹d
 = 
pdFALSE
;

198 
	`´vIn™Ÿli£NewQueue
Ğ
uxQueueL’gth
, 
uxI‹mSize
, 
pucQueueStÜage
, 
ucQueueTy³
, 
pxNewQueue
 );

201  
pxNewQueue
;

202 
	}
}

204 
Ba£Ty³_t
 
	$xQueueG’”icS’d
Ğ
QueueHªdË_t
 
xQueue
,

205 cÚ¡ * cÚ¡ 
pvI‹mToQueue
,

206 
TickTy³_t
 
xTicksToWa™
,

207 cÚ¡ 
Ba£Ty³_t
 
xCİyPos™iÚ
 )

209 
Ba£Ty³_t
 
xEÁryTimeS‘
 = 
pdFALSE
, 
xY›ldRequœed
;

210 
TimeOut_t
 
xTimeOut
;

211 
Queue_t
 * cÚ¡ 
pxQueue
 = 
xQueue
;

219 
	`skENTER_CRITICAL
();

225 ifĞĞ
pxQueue
->
uxMes§gesWa™šg
 <…xQueue->
uxL’gth
 ) || ( 
xCİyPos™iÚ
 =ğ
queueOVERWRITE
 ) )

228 #iàĞ
cÚfigUSE_QUEUE_SETS
 == 1 )

230 cÚ¡ 
UBa£Ty³_t
 
uxP»viousMes§gesWa™šg
 = 
pxQueue
->
uxMes§gesWa™šg
;

232 
xY›ldRequœed
 = 
	`´vCİyD©aToQueue
Ğ
pxQueue
, 
pvI‹mToQueue
, 
xCİyPos™iÚ
 );

234 ifĞ
pxQueue
->
pxQueueS‘CÚš”
 !ğ
NULL
 )

236 ifĞĞ
xCİyPos™iÚ
 =ğ
queueOVERWRITE
 ) && ( 
uxP»viousMes§gesWa™šg
 !ğĞ
UBa£Ty³_t
 ) 0 ) )

242 ifĞ
	`´vNÙifyQueueS‘CÚš”
Ğ
pxQueue
 ) !ğ
pdFALSE
 )

247 
	`queueYIELD_IF_USING_PREEMPTION
();

254 ifĞ
	`li¡LIST_IS_EMPTY
Ğ&Ğ
pxQueue
->
xTasksWa™šgToReûive
 ) ) =ğ
pdFALSE
 )

256 ifĞ
	`xTaskRemoveFromEv’tLi¡
Ğ&Ğ
pxQueue
->
xTasksWa™šgToReûive
 ) ) !ğ
pdFALSE
 )

262 
	`queueYIELD_IF_USING_PREEMPTION
();

265 ifĞ
xY›ldRequœed
 !ğ
pdFALSE
 )

271 
	`queueYIELD_IF_USING_PREEMPTION
();

277 
xY›ldRequœed
 = 
	`´vCİyD©aToQueue
Ğ
pxQueue
, 
pvI‹mToQueue
, 
xCİyPos™iÚ
 );

281 ifĞ
	`li¡LIST_IS_EMPTY
Ğ&Ğ
pxQueue
->
xTasksWa™šgToReûive
 ) ) =ğ
pdFALSE
 )

283 ifĞ
	`xTaskRemoveFromEv’tLi¡
Ğ&Ğ
pxQueue
->
xTasksWa™šgToReûive
 ) ) !ğ
pdFALSE
 )

289 
	`queueYIELD_IF_USING_PREEMPTION
();

292 ifĞ
xY›ldRequœed
 !ğ
pdFALSE
 )

298 
	`queueYIELD_IF_USING_PREEMPTION
();

303 
	`skEXIT_CRITICAL
();

304  
pdPASS
;

308 ifĞ
xTicksToWa™
 =ğĞ
TickTy³_t
 ) 0 )

312 
	`skEXIT_CRITICAL
();

316  
”rQUEUE_FULL
;

318 ifĞ
xEÁryTimeS‘
 =ğ
pdFALSE
 )

322 
	`vTaskIÁ”ÇlS‘TimeOutS‹
Ğ&
xTimeOut
 );

323 
xEÁryTimeS‘
 = 
pdTRUE
;

327 
	`skEXIT_CRITICAL
();

332 
	`vTaskSu¥’dAÎ
();

333 
	`´vLockQueue
Ğ
pxQueue
 );

336 ifĞ
	`xTaskCheckFÜTimeOut
Ğ&
xTimeOut
, &
xTicksToWa™
 ) =ğ
pdFALSE
 )

338 ifĞ
	`´vIsQueueFuÎ
Ğ
pxQueue
 ) !ğ
pdFALSE
 )

340 
	`vTaskPÏûOnEv’tLi¡
Ğ&Ğ
pxQueue
->
xTasksWa™šgToS’d
 ), 
xTicksToWa™
 );

347 
	`´vUÆockQueue
Ğ
pxQueue
 );

354 ifĞ
	`xTaskResumeAÎ
(è=ğ
pdFALSE
 )

356 
	`pÜtYIELD_WITHIN_API
();

362 
	`´vUÆockQueue
Ğ
pxQueue
 );

363 Ğè
	`xTaskResumeAÎ
();

369 
	`´vUÆockQueue
Ğ
pxQueue
 );

370 Ğè
	`xTaskResumeAÎ
();

372  
”rQUEUE_FULL
;

375 
	}
}

377 
Ba£Ty³_t
 
	$xQueueReûive
Ğ
QueueHªdË_t
 
xQueue
,

378 * cÚ¡ 
pvBufãr
,

379 
TickTy³_t
 
xTicksToWa™
 )

381 
Ba£Ty³_t
 
xEÁryTimeS‘
 = 
pdFALSE
;

382 
TimeOut_t
 
xTimeOut
;

383 
Queue_t
 * cÚ¡ 
pxQueue
 = 
xQueue
;

398 
	`skENTER_CRITICAL
();

400 cÚ¡ 
UBa£Ty³_t
 
uxMes§gesWa™šg
 = 
pxQueue
->uxMessagesWaiting;

404 ifĞ
uxMes§gesWa™šg
 > ( 
UBa£Ty³_t
 ) 0 )

407 
	`´vCİyD©aFromQueue
Ğ
pxQueue
, 
pvBufãr
 );

408 
pxQueue
->
uxMes§gesWa™šg
 = uxMes§gesWa™šg - ( 
UBa£Ty³_t
 ) 1;

413 ifĞ
	`li¡LIST_IS_EMPTY
Ğ&Ğ
pxQueue
->
xTasksWa™šgToS’d
 ) ) =ğ
pdFALSE
 )

415 ifĞ
	`xTaskRemoveFromEv’tLi¡
Ğ&Ğ
pxQueue
->
xTasksWa™šgToS’d
 ) ) !ğ
pdFALSE
 )

417 
	`queueYIELD_IF_USING_PREEMPTION
();

421 
	`mtCOVERAGE_TEST_MARKER
();

426 
	`mtCOVERAGE_TEST_MARKER
();

429 
	`skEXIT_CRITICAL
();

430  
pdPASS
;

434 ifĞ
xTicksToWa™
 =ğĞ
TickTy³_t
 ) 0 )

438 
	`skEXIT_CRITICAL
();

439 
	`ŒaûQUEUE_RECEIVE_FAILED
Ğ
pxQueue
 );

440  
”rQUEUE_EMPTY
;

442 ifĞ
xEÁryTimeS‘
 =ğ
pdFALSE
 )

446 
	`vTaskIÁ”ÇlS‘TimeOutS‹
Ğ&
xTimeOut
 );

447 
xEÁryTimeS‘
 = 
pdTRUE
;

452 
	`mtCOVERAGE_TEST_MARKER
();

456 
	`skEXIT_CRITICAL
();

461 
	`vTaskSu¥’dAÎ
();

462 
	`´vLockQueue
Ğ
pxQueue
 );

465 ifĞ
	`xTaskCheckFÜTimeOut
Ğ&
xTimeOut
, &
xTicksToWa™
 ) =ğ
pdFALSE
 )

469 ifĞ
	`´vIsQueueEm±y
Ğ
pxQueue
 ) !ğ
pdFALSE
 )

471 
	`ŒaûBLOCKING_ON_QUEUE_RECEIVE
Ğ
pxQueue
 );

472 
	`vTaskPÏûOnEv’tLi¡
Ğ&Ğ
pxQueue
->
xTasksWa™šgToReûive
 ), 
xTicksToWa™
 );

473 
	`´vUÆockQueue
Ğ
pxQueue
 );

475 ifĞ
	`xTaskResumeAÎ
(è=ğ
pdFALSE
 )

477 
	`pÜtYIELD_WITHIN_API
();

481 
	`mtCOVERAGE_TEST_MARKER
();

488 
	`´vUÆockQueue
Ğ
pxQueue
 );

489 Ğè
	`xTaskResumeAÎ
();

496 
	`´vUÆockQueue
Ğ
pxQueue
 );

497 Ğè
	`xTaskResumeAÎ
();

499 ifĞ
	`´vIsQueueEm±y
Ğ
pxQueue
 ) !ğ
pdFALSE
 )

501 
	`ŒaûQUEUE_RECEIVE_FAILED
Ğ
pxQueue
 );

502  
”rQUEUE_EMPTY
;

506 
	`mtCOVERAGE_TEST_MARKER
();

510 
	}
}

513 
Ba£Ty³_t
 
	$´vCİyD©aToQueue
Ğ
Queue_t
 * cÚ¡ 
pxQueue
,

514 cÚ¡ * 
pvI‹mToQueue
,

515 cÚ¡ 
Ba£Ty³_t
 
xPos™iÚ
 )

517 
Ba£Ty³_t
 
xR‘uº
 = 
pdFALSE
;

518 
UBa£Ty³_t
 
uxMes§gesWa™šg
;

522 
uxMes§gesWa™šg
 = 
pxQueue
->uxMessagesWaiting;

524 ifĞ
pxQueue
->
uxI‹mSize
 =ğĞ
UBa£Ty³_t
 ) 0 )

526 #iàĞ
cÚfigUSE_MUTEXES
 == 1 )

528 ifĞ
pxQueue
->
uxQueueTy³
 =ğ
queueQUEUE_IS_MUTEX
 )

531 
xR‘uº
 = 
	`xTaskPriÜ™yDisšh”™
Ğ
pxQueue
->
u
.
xSem­hÜe
.
xMu‹xHŞd”
 );

532 
pxQueue
->
u
.
xSem­hÜe
.
xMu‹xHŞd”
 = 
NULL
;

536 
	`mtCOVERAGE_TEST_MARKER
();

541 ifĞ
xPos™iÚ
 =ğ
queueSEND_TO_BACK
 )

543 Ğè
	`memıy
ĞĞ* ) 
pxQueue
->
pcWr™eTo
, 
pvI‹mToQueue
, ( 
size_t
 )…xQueue->
uxI‹mSize
 );

544 
pxQueue
->
pcWr™eTo
 +ğpxQueue->
uxI‹mSize
;

546 ifĞ
pxQueue
->
pcWr™eTo
 >ğpxQueue->
u
.
xQueue
.
pcTa
 )

548 
pxQueue
->
pcWr™eTo
 =…xQueue->
pcH—d
;

552 
	`mtCOVERAGE_TEST_MARKER
();

557 Ğè
	`memıy
ĞĞ* ) 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
, 
pvI‹mToQueue
, ( 
size_t
 )…xQueue->
uxI‹mSize
 );

558 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 -ğpxQueue->
uxI‹mSize
;

560 ifĞ
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 <…xQueue->
pcH—d
 )

562 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 = (…xQueue->u.xQueue.
pcTa
 -…xQueue->
uxI‹mSize
 );

566 
	`mtCOVERAGE_TEST_MARKER
();

569 ifĞ
xPos™iÚ
 =ğ
queueOVERWRITE
 )

571 ifĞ
uxMes§gesWa™šg
 > ( 
UBa£Ty³_t
 ) 0 )

577 --
uxMes§gesWa™šg
;

581 
	`mtCOVERAGE_TEST_MARKER
();

586 
	`mtCOVERAGE_TEST_MARKER
();

590 
pxQueue
->
uxMes§gesWa™šg
 = uxMes§gesWa™šg + ( 
UBa£Ty³_t
 ) 1;

592  
xR‘uº
;

593 
	}
}

596 
	$´vCİyD©aFromQueue
Ğ
Queue_t
 * cÚ¡ 
pxQueue
,

597 * cÚ¡ 
pvBufãr
 )

599 ifĞ
pxQueue
->
uxI‹mSize
 !ğĞ
UBa£Ty³_t
 ) 0 )

601 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 +ğpxQueue->
uxI‹mSize
;

603 ifĞ
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 >ğpxQueue->u.xQueue.
pcTa
 )

605 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
 =…xQueue->
pcH—d
;

609 
	`mtCOVERAGE_TEST_MARKER
();

612 Ğè
	`memıy
ĞĞ* ) 
pvBufãr
, ( * ) 
pxQueue
->
u
.
xQueue
.
pcR—dFrom
, ( 
size_t
 )…xQueue->
uxI‹mSize
 );

614 
	}
}

616 
Ba£Ty³_t
 
	$´vIsQueueEm±y
ĞcÚ¡ 
Queue_t
 * 
pxQueue
 )

618 
Ba£Ty³_t
 
xR‘uº
;

620 
	`skENTER_CRITICAL
();

622 ifĞ
pxQueue
->
uxMes§gesWa™šg
 =ğĞ
UBa£Ty³_t
 ) 0 )

624 
xR‘uº
 = 
pdTRUE
;

628 
xR‘uº
 = 
pdFALSE
;

631 
	`skEXIT_CRITICAL
();

633  
xR‘uº
;

634 
	}
}

637 
Ba£Ty³_t
 
	$´vIsQueueFuÎ
ĞcÚ¡ 
Queue_t
 * 
pxQueue
 )

639 
Ba£Ty³_t
 
xR‘uº
;

641 
	`skENTER_CRITICAL
();

643 ifĞ
pxQueue
->
uxMes§gesWa™šg
 =ğpxQueue->
uxL’gth
 )

645 
xR‘uº
 = 
pdTRUE
;

649 
xR‘uº
 = 
pdFALSE
;

652 
	`skEXIT_CRITICAL
();

654  
xR‘uº
;

655 
	}
}

	@Memory/include/heap.h

1 *
pvPÜtM®loc
Ğ
size_t
 
xWª‹dSize
 );

2 
vPÜtF»e
Ğ*
pv
 );

	@Memory/src/heap.c

1 
	~<h—p2.h
>

2 
	#pÜtBYTE_ALIGNMENT
 8

	)

3 
	#cÚfigTOTAL_HEAP_SIZE
 ( ( 
size_t
 ) ( 100 * 1024 ) )

	)

4 
	#pÜtBYTE_ALIGNMENT_MASK
 ( 0x0007 )

	)

6 
	sA_BLOCK_LINK


8 
A_BLOCK_LINK
 *
	mpxNextF»eBlock
;

9 
size_t
 
	mxBlockSize
;

10 } 
	tBlockLšk_t
;

14 
BlockLšk_t
 
	gxS¹
, 
	gxEnd
;

18 
ušt8_t
 
	gucH—p
[ 
cÚfigTOTAL_HEAP_SIZE
 ];

23 
	#cÚfigADJUSTED_HEAP_SIZE
 ( 
cÚfigTOTAL_HEAP_SIZE
 - 
pÜtBYTE_ALIGNMENT
 )

	)

25 
size_t
 
	gxF»eBy‹sRemaššg
 = 
cÚfigADJUSTED_HEAP_SIZE
;

36 
	#´vIn£¹BlockIÁoF»eLi¡
Ğ
pxBlockToIn£¹
 ) \

38 
BlockLšk_t
 *
pxI‹¿tÜ
; \

39 
size_t
 
xBlockSize
; \

41 
xBlockSize
 = 
pxBlockToIn£¹
->xBlockSize; \

45  
pxI‹¿tÜ
 = &
xS¹
;…xI‹¿tÜ->
pxNextF»eBlock
->
xBlockSize
 < xBlockSize;…xIterator =…xIterator->pxNextFreeBlock ) \

52 
pxBlockToIn£¹
->
pxNextF»eBlock
 = 
pxI‹¿tÜ
->pxNextFreeBlock; \

53 
pxI‹¿tÜ
->
pxNextF»eBlock
 = 
pxBlockToIn£¹
; \

54 }

	)

57 cÚ¡ 
ušt16_t
 
	gh—pSTRUCT_SIZE
 = ( (  ( 
BlockLšk_t
 ) + ( 
pÜtBYTE_ALIGNMENT
 - 1 ) ) & ~
pÜtBYTE_ALIGNMENT_MASK
 );

58 
	$´vH—pIn™
( )

60 
BlockLšk_t
* 
pxFœ¡F»eBlock
;

61 
ušt8_t
 *
pucAligÃdH—p
;

62 
pucAligÃdH—p
 = (
ušt8_t
*)(((
pÜtPOINTER_SIZE_TYPE
)&
ucH—p
[
pÜtBYTE_ALIGNMENT
])&(~(ÕÜtPOINTER_SIZE_TYPE)
pÜtBYTE_ALIGNMENT_MASK
 ) ) );

64 
xS¹
.
pxNextF»eBlock
 = (*)
pucAligÃdH—p
;

65 
xS¹
.
xBlockSize
 = 0;

67 
xEnd
.
pxNextF»eBlock
 = 
NULL
;

68 
xEnd
.
xBlockSize
 = 
cÚfigADJUSTED_HEAP_SIZE
;

72 
pxFœ¡F»eBlock
 = ( * ) 
pucAligÃdH—p
;

73 
pxFœ¡F»eBlock
->
xBlockSize
 = 
cÚfigADJUSTED_HEAP_SIZE
;

74 
pxFœ¡F»eBlock
->
pxNextF»eBlock
 = &
xEnd
;

76 
	}
}

79 *
	$pvPÜtM®loc
Ğ
size_t
 
xWª‹dSize
 )

81 
BlockLšk_t
 *
pxBlock
, *
pxP»viousBlock
, *
pxNewBlockLšk
;

82 
boŞ
 
xH—pHasB“nIn™Ÿli£d
 = 
çl£
;

83 *
pvR‘uº
 = 
NULL
;

85 ifĞ
xH—pHasB“nIn™Ÿli£d
 =ğ
çl£
)

87 
	`´vH—pIn™
();

88 
xH—pHasB“nIn™Ÿli£d
 = 
Œue
;

93 ifĞ
xWª‹dSize
 > 0 )

95 
xWª‹dSize
 +ğ
h—pSTRUCT_SIZE
;

98 ifĞĞ
xWª‹dSize
 & 
pÜtBYTE_ALIGNMENT_MASK
 ) != 0 )

101 
xWª‹dSize
 +ğĞ
pÜtBYTE_ALIGNMENT
 - ( xWª‹dSiz& 
pÜtBYTE_ALIGNMENT_MASK
 ) );

106 ifĞĞ
xWª‹dSize
 > 0 ) && ( xWª‹dSiz< 
cÚfigADJUSTED_HEAP_SIZE
 ) )

110 
pxP»viousBlock
 = &
xS¹
;

111 
pxBlock
 = 
xS¹
.
pxNextF»eBlock
;

112  ( 
pxBlock
->
xBlockSize
 < 
xWª‹dSize
 ) && (…xBlock->
pxNextF»eBlock
 !ğ
NULL
 ) )

114 
pxP»viousBlock
 = 
pxBlock
;

115 
pxBlock
 =…xBlock->
pxNextF»eBlock
;

119 ifĞ
pxBlock
 !ğ&
xEnd
 )

123 
pvR‘uº
 = ( * ) ( ( ( 
ušt8_t
 * ) 
pxP»viousBlock
->
pxNextF»eBlock
 ) + 
h—pSTRUCT_SIZE
 );

127 
pxP»viousBlock
->
pxNextF»eBlock
 = 
pxBlock
->pxNextFreeBlock;

130 ifĞĞ
pxBlock
->
xBlockSize
 - 
xWª‹dSize
 ) > 
h—pMINIMUM_BLOCK_SIZE
 )

135 
pxNewBlockLšk
 = ( * ) ( ( ( 
ušt8_t
 * ) 
pxBlock
 ) + 
xWª‹dSize
 );

139 
pxNewBlockLšk
->
xBlockSize
 = 
pxBlock
->xBlockSiz- 
xWª‹dSize
;

140 
pxBlock
->
xBlockSize
 = 
xWª‹dSize
;

143 
	`´vIn£¹BlockIÁoF»eLi¡
ĞĞ
pxNewBlockLšk
 ) );

146 
xF»eBy‹sRemaššg
 -ğ
pxBlock
->
xBlockSize
;

151  
pvR‘uº
;

153 
	}
}

154 
	$vPÜtF»e
Ğ*
pv
 )

156 
ušt8_t
 *
puc
 = ( ušt8_ˆ* ) 
pv
;

157 
BlockLšk_t
 *
pxLšk
;

158 ifĞ
pv
 !ğ
NULL
 )

162 
puc
 -ğ
h—pSTRUCT_SIZE
;

166 
pxLšk
 = ( * ) 
puc
;

169 
	`´vIn£¹BlockIÁoF»eLi¡
ĞĞĞ
BlockLšk_t
 * ) 
pxLšk
 ) );

170 
xF»eBy‹sRemaššg
 +ğ
pxLšk
->
xBlockSize
;

173 
	}
}

	@Softtime/include/time.h

1 
	#tmrCOMMAND_EXECUTE_CALLBACK_FROM_ISR
 ( ( 
Ba£Ty³_t
 ) -2 )

	)

2 
	#tmrCOMMAND_EXECUTE_CALLBACK
 ( ( 
Ba£Ty³_t
 ) -1 )

	)

3 
	#tmrCOMMAND_START_DONT_TRACE
 ( ( 
Ba£Ty³_t
 ) 0 )

	)

4 
	#tmrCOMMAND_START
 ( ( 
Ba£Ty³_t
 ) 1 )

	)

5 
	#tmrCOMMAND_RESET
 ( ( 
Ba£Ty³_t
 ) 2 )

	)

6 
	#tmrCOMMAND_STOP
 ( ( 
Ba£Ty³_t
 ) 3 )

	)

7 
	#tmrCOMMAND_CHANGE_PERIOD
 ( ( 
Ba£Ty³_t
 ) 4 )

	)

8 
	#tmrCOMMAND_DELETE
 ( ( 
Ba£Ty³_t
 ) 5 )

	)

10 
	#tmrFIRST_FROM_ISR_COMMAND
 ( ( 
Ba£Ty³_t
 ) 6 )

	)

11 
	#tmrCOMMAND_START_FROM_ISR
 ( ( 
Ba£Ty³_t
 ) 6 )

	)

12 
	#tmrCOMMAND_RESET_FROM_ISR
 ( ( 
Ba£Ty³_t
 ) 7 )

	)

13 
	#tmrCOMMAND_STOP_FROM_ISR
 ( ( 
Ba£Ty³_t
 ) 8 )

	)

14 
	#tmrCOMMAND_CHANGE_PERIOD_FROM_ISR
 ( ( 
Ba£Ty³_t
 ) 9 )

	)

16 
	gtmrTim”CÚŒŞ
;

17 
tmrTim”CÚŒŞ
 * 
	tTim”HªdË_t
;

19 (* 
	tTim”C®lbackFunùiÚ_t
)Ğ
	tTim”HªdË_t
 
	txTim”
 );

21 (* 
	tP’dedFunùiÚ_t
)( *,

22 
	tušt32_t
 );

24 
	#xTim”S¹
Ğ
xTim”
, 
xTicksToWa™
 ) \

25 
	`xTim”G’”icCommªd
ĞĞ
xTim”
 ), 
tmrCOMMAND_START
, ( 
	`xTaskG‘TickCouÁ
(è), 
NULL
, ( 
xTicksToWa™
 ) )

	)

	@Softtime/src/time.c

2 
	~<time.h
>

3 
	#pÜtTASK_FUNCTION_PROTO
Ğ
vFunùiÚ
, 
pvP¬am‘”s
 ) 
	`vFunùiÚ
Ğ*…vP¬am‘” )

	)

5 
	stmrTim”CÚŒŞ


7 cÚ¡ * 
	mpcTim”Name
;

8 
Li¡I‹m_t
 
	mxTim”Li¡I‹m
;

9 
TickTy³_t
 
	mxTim”P”iodInTicks
;

10 * 
	mpvTim”ID
;

11 
Tim”C®lbackFunùiÚ_t
 
	mpxC®lbackFunùiÚ
;

12 #iàĞ
cÚfigUSE_TRACE_FACILITY
 == 1 )

13 
UBa£Ty³_t
 
	muxTim”Numb”
;

15 
ušt8_t
 
	mucStus
;

16 } 
	txTIMER
;

18 
xTIMER
 
	tTim”_t
;

19 
	stmrTim”P¬am‘”s


21 
TickTy³_t
 
	mxMes§geV®ue
;

22 
Tim”_t
 * 
	mpxTim”
;

23 } 
	tTim”P¬am‘”_t
;

26 
	stmrC®lbackP¬am‘”s


28 
P’dedFunùiÚ_t
 
	mpxC®lbackFunùiÚ
;

29 * 
	mpvP¬am‘”1
;

30 
ušt32_t
 
	mulP¬am‘”2
;

31 } 
	tC®lbackP¬am‘”s_t
;

34 
	#tmrSTATUS_IS_ACTIVE
 ( ( 
ušt8_t
 ) 0x01 )

	)

35 
	#tmrSTATUS_IS_STATICALLY_ALLOCATED
 ( ( 
ušt8_t
 ) 0x02 )

	)

36 
	#tmrSTATUS_IS_AUTORELOAD
 ( ( 
ušt8_t
 ) 0x04 )

	)

41 
	$´vTim”Task
Ğ*
pvP¬am‘”s
 )

43 
TickTy³_t
 
xNextExpœeTime
;

44 
Ba£Ty³_t
 
xLi¡WasEm±y
;

49 
xNextExpœeTime
 = 
	`´vG‘NextExpœeTime
Ğ&
xLi¡WasEm±y
 );

53 
	`´vProûssTim”OrBlockTask
Ğ
xNextExpœeTime
, 
xLi¡WasEm±y
 );

56 
	`´vProûssReûivedCommªds
();

58 
	}
}

63 
	$pÜtTASK_FUNCTION
Ğ
´vTim”Task
, 
pvP¬am‘”s
 )

65 
TickTy³_t
 
xNextExpœeTime
;

66 
Ba£Ty³_t
 
xLi¡WasEm±y
;

69 Ğè
pvP¬am‘”s
;

71 #iàĞ
cÚfigUSE_DAEMON_TASK_STARTUP_HOOK
 == 1 )

73 
	`vAµliÿtiÚD«mÚTaskS¹upHook
( );

79 
	`vAµliÿtiÚD«mÚTaskS¹upHook
();

87 
xNextExpœeTime
 = 
	`´vG‘NextExpœeTime
Ğ&
xLi¡WasEm±y
 );

91 
	`´vProûssTim”OrBlockTask
Ğ
xNextExpœeTime
, 
xLi¡WasEm±y
 );

94 
	`´vProûssReûivedCommªds
();

96 
	}
}

97 
	$´vCheckFÜV®idLi¡AndQueue
( )

102 
	`skENTER_CRITICAL
();

104 ifĞ
xTim”Queue
 =ğ
NULL
 )

106 
	`vLi¡In™Ÿli£
Ğ&
xAùiveTim”Li¡1
 );

107 
	`vLi¡In™Ÿli£
Ğ&
xAùiveTim”Li¡2
 );

108 
pxCu¼’tTim”Li¡
 = &
xAùiveTim”Li¡1
;

109 
pxOv”æowTim”Li¡
 = &
xAùiveTim”Li¡2
;

111 #iàĞ
cÚfigSUPPORT_STATIC_ALLOCATION
 == 1 )

115 
PRIVILEGED_DATA
 
SticQueue_t
 
xSticTim”Queue
;

116 
PRIVILEGED_DATA
 
ušt8_t
 
ucSticTim”QueueStÜage
[ ( 
size_t
 ) 
cÚfigTIMER_QUEUE_LENGTH
 * Ğ
D«mÚTaskMes§ge_t
 ) ];

118 
xTim”Queue
 = 
	`xQueueC»©eStic
ĞĞ
UBa£Ty³_t
 ) 
cÚfigTIMER_QUEUE_LENGTH
, ( UBa£Ty³_ˆèĞ
D«mÚTaskMes§ge_t
 ), &Ğ
ucSticTim”QueueStÜage
[ 0 ] ), &
xSticTim”Queue
 );

122 
xTim”Queue
 = 
	`xQueueC»©e
ĞĞ
UBa£Ty³_t
 ) 
cÚfigTIMER_QUEUE_LENGTH
, Ğ
D«mÚTaskMes§ge_t
 ) );

126 #iàĞ
cÚfigQUEUE_REGISTRY_SIZE
 > 0 )

128 ifĞ
xTim”Queue
 !ğ
NULL
 )

130 
	`vQueueAddToRegi¡ry
Ğ
xTim”Queue
, "TmrQ" );

134 
	`mtCOVERAGE_TEST_MARKER
();

141 
	`mtCOVERAGE_TEST_MARKER
();

144 
	`skEXIT_CRITICAL
();

145 
	}
}

148 
TickTy³_t
 
	$´vG‘NextExpœeTime
Ğ
Ba£Ty³_t
 * cÚ¡ 
pxLi¡WasEm±y
 )

150 
TickTy³_t
 
xNextExpœeTime
;

159 *
pxLi¡WasEm±y
 = 
	`li¡LIST_IS_EMPTY
Ğ
pxCu¼’tTim”Li¡
 );

161 ifĞ*
pxLi¡WasEm±y
 =ğ
pdFALSE
 )

163 
xNextExpœeTime
 = 
	`li¡GET_ITEM_VALUE_OF_HEAD_ENTRY
Ğ
pxCu¼’tTim”Li¡
 );

168 
xNextExpœeTime
 = ( 
TickTy³_t
 ) 0U;

171  
xNextExpœeTime
;

172 
	}
}

174 
	$´vIn™Ÿli£NewTim”
ĞcÚ¡ * cÚ¡ 
pcTim”Name
,

175 cÚ¡ 
TickTy³_t
 
xTim”P”iodInTicks
,

176 cÚ¡ 
UBa£Ty³_t
 
uxAutoR–ßd
,

177 * cÚ¡ 
pvTim”ID
,

178 
Tim”C®lbackFunùiÚ_t
 
pxC®lbackFunùiÚ
,

179 
Tim”_t
 * 
pxNewTim”
 )

182 ifĞ
pxNewTim”
 !ğ
NULL
 )

186 
	`´vCheckFÜV®idLi¡AndQueue
();

190 
pxNewTim”
->
pcTim”Name
 =…cTimerName;

191 
pxNewTim”
->
xTim”P”iodInTicks
 = xTimerPeriodInTicks;

192 
pxNewTim”
->
pvTim”ID
 =…vTimerID;

193 
pxNewTim”
->
pxC®lbackFunùiÚ
 =…xCallbackFunction;

194 
	`vLi¡In™Ÿli£I‹m
Ğ&Ğ
pxNewTim”
->
xTim”Li¡I‹m
 ) );

196 ifĞ
uxAutoR–ßd
 !ğ
pdFALSE
 )

198 
pxNewTim”
->
ucStus
 |ğ
tmrSTATUS_IS_AUTORELOAD
;

202 
	}
}

204 
Ba£Ty³_t
 
	$´vIn£¹Tim”InAùiveLi¡
Ğ
Tim”_t
 * cÚ¡ 
pxTim”
,

205 cÚ¡ 
TickTy³_t
 
xNextExpœyTime
,

206 cÚ¡ 
TickTy³_t
 
xTimeNow
,

207 cÚ¡ 
TickTy³_t
 
xCommªdTime
 )

209 
Ba£Ty³_t
 
xProûssTim”Now
 = 
pdFALSE
;

211 
	`li¡SET_LIST_ITEM_VALUE
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ), 
xNextExpœyTime
 );

212 
	`li¡SET_LIST_ITEM_OWNER
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ),…xTimer );

214 ifĞ
xNextExpœyTime
 <ğ
xTimeNow
 )

218 ifĞĞĞ
TickTy³_t
 ) ( 
xTimeNow
 - 
xCommªdTime
 ) ) >ğ
pxTim”
->
xTim”P”iodInTicks
 )

222 
xProûssTim”Now
 = 
pdTRUE
;

226 
	`vLi¡In£¹
Ğ
pxOv”æowTim”Li¡
, &Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

231 ifĞĞ
xTimeNow
 < 
xCommªdTime
 ) && ( 
xNextExpœyTime
 >= xCommandTime ) )

236 
xProûssTim”Now
 = 
pdTRUE
;

240 
	`vLi¡In£¹
Ğ
pxCu¼’tTim”Li¡
, &Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

244  
xProûssTim”Now
;

245 
	}
}

248 
	$´vProûssExpœedTim”
ĞcÚ¡ 
TickTy³_t
 
xNextExpœeTime
,

249 cÚ¡ 
TickTy³_t
 
xTimeNow
 )

251 
Ba£Ty³_t
 
xResuÉ
;

252 
Tim”_t
 * cÚ¡ 
pxTim”
 = ( Tim”_ˆ* ) 
	`li¡GET_OWNER_OF_HEAD_ENTRY
Ğ
pxCu¼’tTim”Li¡
 );

257 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

258 
	`ŒaûTIMER_EXPIRED
Ğ
pxTim”
 );

262 ifĞĞ
pxTim”
->
ucStus
 & 
tmrSTATUS_IS_AUTORELOAD
 ) != 0 )

267 ifĞ
	`´vIn£¹Tim”InAùiveLi¡
Ğ
pxTim”
, ( 
xNextExpœeTime
 +…xTim”->
xTim”P”iodInTicks
 ), 
xTimeNow
, xNextExpœeTimè!ğ
pdFALSE
 )

271 
xResuÉ
 = 
	`xTim”G’”icCommªd
Ğ
pxTim”
, 
tmrCOMMAND_START_DONT_TRACE
, 
xNextExpœeTime
, 
NULL
, 
tmrNO_DELAY
 );

272 Ğè
xResuÉ
;

276 
	`mtCOVERAGE_TEST_MARKER
();

281 
pxTim”
->
ucStus
 &ğ~
tmrSTATUS_IS_ACTIVE
;

282 
	`mtCOVERAGE_TEST_MARKER
();

286 
pxTim”
->
	`pxC®lbackFunùiÚ
ĞĞ
Tim”HªdË_t
 )…xTimer );

287 
	}
}

290 
	$´vProûssReûivedCommªds
( )

292 
D«mÚTaskMes§ge_t
 
xMes§ge
;

293 
Tim”_t
 * 
pxTim”
;

294 
Ba£Ty³_t
 
xTim”Li¡sW”eSw™ched
, 
xResuÉ
;

295 
TickTy³_t
 
xTimeNow
;

297  
	`xQueueReûive
Ğ
xTim”Queue
, &
xMes§ge
, 
tmrNO_DELAY
 ) !ğ
pdFAIL
 )

299 #iàĞ
INCLUDE_xTim”P’dFunùiÚC®l
 == 1 )

303 ifĞ
xMes§ge
.
xMes§geID
 < ( 
Ba£Ty³_t
 ) 0 )

305 cÚ¡ 
C®lbackP¬am‘”s_t
 * cÚ¡ 
pxC®lback
 = &Ğ
xMes§ge
.
u
.
xC®lbackP¬am‘”s
 );

311 
pxC®lback
->
	`pxC®lbackFunùiÚ
ĞpxC®lback->
pvP¬am‘”1
,…xC®lback->
ulP¬am‘”2
 );

315 
	`mtCOVERAGE_TEST_MARKER
();

322 ifĞ
xMes§ge
.
xMes§geID
 >ğĞ
Ba£Ty³_t
 ) 0 )

326 
pxTim”
 = 
xMes§ge
.
u
.
xTim”P¬am‘”s
.pxTimer;

328 ifĞ
	`li¡IS_CONTAINED_WITHIN
Ğ
NULL
, &Ğ
pxTim”
->
xTim”Li¡I‹m
 ) ) =ğ
pdFALSE
 )

331 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

335 
	`mtCOVERAGE_TEST_MARKER
();

338 
	`ŒaûTIMER_COMMAND_RECEIVED
Ğ
pxTim”
, 
xMes§ge
.
xMes§geID
, xMes§ge.
u
.
xTim”P¬am‘”s
.
xMes§geV®ue
 );

346 
xTimeNow
 = 
	`´vSam¶eTimeNow
Ğ&
xTim”Li¡sW”eSw™ched
 );

348  
xMes§ge
.
xMes§geID
 )

350 
tmrCOMMAND_START
:

351 
tmrCOMMAND_START_FROM_ISR
:

352 
tmrCOMMAND_RESET
:

353 
tmrCOMMAND_RESET_FROM_ISR
:

354 
tmrCOMMAND_START_DONT_TRACE
:

356 
pxTim”
->
ucStus
 |ğ
tmrSTATUS_IS_ACTIVE
;

358 ifĞ
	`´vIn£¹Tim”InAùiveLi¡
Ğ
pxTim”
, 
xMes§ge
.
u
.
xTim”P¬am‘”s
.
xMes§geV®ue
 +…xTim”->
xTim”P”iodInTicks
, 
xTimeNow
, xMes§ge.u.xTim”P¬am‘”s.xMes§geV®uè!ğ
pdFALSE
 )

362 
pxTim”
->
	`pxC®lbackFunùiÚ
ĞĞ
Tim”HªdË_t
 )…xTimer );

363 
	`ŒaûTIMER_EXPIRED
Ğ
pxTim”
 );

365 ifĞĞ
pxTim”
->
ucStus
 & 
tmrSTATUS_IS_AUTORELOAD
 ) != 0 )

367 
xResuÉ
 = 
	`xTim”G’”icCommªd
Ğ
pxTim”
, 
tmrCOMMAND_START_DONT_TRACE
, 
xMes§ge
.
u
.
xTim”P¬am‘”s
.
xMes§geV®ue
 +…xTim”->
xTim”P”iodInTicks
, 
NULL
, 
tmrNO_DELAY
 );

368 Ğè
xResuÉ
;

372 
	`mtCOVERAGE_TEST_MARKER
();

377 
	`mtCOVERAGE_TEST_MARKER
();

382 
tmrCOMMAND_STOP
:

383 
tmrCOMMAND_STOP_FROM_ISR
:

385 
pxTim”
->
ucStus
 &ğ~
tmrSTATUS_IS_ACTIVE
;

388 
tmrCOMMAND_CHANGE_PERIOD
:

389 
tmrCOMMAND_CHANGE_PERIOD_FROM_ISR
:

390 
pxTim”
->
ucStus
 |ğ
tmrSTATUS_IS_ACTIVE
;

391 
pxTim”
->
xTim”P”iodInTicks
 = 
xMes§ge
.
u
.
xTim”P¬am‘”s
.
xMes§geV®ue
;

399 Ğè
	`´vIn£¹Tim”InAùiveLi¡
Ğ
pxTim”
, ( 
xTimeNow
 +…xTim”->
xTim”P”iodInTicks
 ), xTimeNow, xTimeNow );

402 
tmrCOMMAND_DELETE
:

403 #iàĞ
cÚfigSUPPORT_DYNAMIC_ALLOCATION
 == 1 )

408 ifĞĞ
pxTim”
->
ucStus
 & 
tmrSTATUS_IS_STATICALLY_ALLOCATED
 ) =ğĞ
ušt8_t
 ) 0 )

410 
	`vPÜtF»e
Ğ
pxTim”
 );

414 
pxTim”
->
ucStus
 &ğ~
tmrSTATUS_IS_ACTIVE
;

423 
pxTim”
->
ucStus
 &ğ~
tmrSTATUS_IS_ACTIVE
;

434 
	}
}

437 
	$´vProûssTim”OrBlockTask
ĞcÚ¡ 
TickTy³_t
 
xNextExpœeTime
,

438 
Ba£Ty³_t
 
xLi¡WasEm±y
 )

440 
TickTy³_t
 
xTimeNow
;

441 
Ba£Ty³_t
 
xTim”Li¡sW”eSw™ched
;

443 
	`vTaskSu¥’dAÎ
();

450 
xTimeNow
 = 
	`´vSam¶eTimeNow
Ğ&
xTim”Li¡sW”eSw™ched
 );

452 ifĞ
xTim”Li¡sW”eSw™ched
 =ğ
pdFALSE
 )

455 ifĞĞ
xLi¡WasEm±y
 =ğ
pdFALSE
 ) && ( 
xNextExpœeTime
 <ğ
xTimeNow
 ) )

457 Ğè
	`xTaskResumeAÎ
();

458 
	`´vProûssExpœedTim”
Ğ
xNextExpœeTime
, 
xTimeNow
 );

468 ifĞ
xLi¡WasEm±y
 !ğ
pdFALSE
 )

472 
xLi¡WasEm±y
 = 
	`li¡LIST_IS_EMPTY
Ğ
pxOv”æowTim”Li¡
 );

475 
	`vQueueWa™FÜMes§geRe¡riùed
Ğ
xTim”Queue
, ( 
xNextExpœeTime
 - 
xTimeNow
 ), 
xLi¡WasEm±y
 );

477 ifĞ
	`xTaskResumeAÎ
(è=ğ
pdFALSE
 )

483 
	`pÜtYIELD_WITHIN_API
();

489 Ğè
	`xTaskResumeAÎ
();

492 
	}
}

494 
TickTy³_t
 
	$´vSam¶eTimeNow
Ğ
Ba£Ty³_t
 * cÚ¡ 
pxTim”Li¡sW”eSw™ched
 )

496 
TickTy³_t
 
xTimeNow
;

497 
PRIVILEGED_DATA
 
TickTy³_t
 
xLa¡Time
 = ( TickType_t ) 0U;

499 
xTimeNow
 = 
	`xTaskG‘TickCouÁ
();

501 ifĞ
xTimeNow
 < 
xLa¡Time
 )

503 
	`´vSw™chTim”Li¡s
();

504 *
pxTim”Li¡sW”eSw™ched
 = 
pdTRUE
;

508 *
pxTim”Li¡sW”eSw™ched
 = 
pdFALSE
;

511 
xLa¡Time
 = 
xTimeNow
;

513  
xTimeNow
;

514 
	}
}

516 
	$´vSw™chTim”Li¡s
( )

518 
TickTy³_t
 
xNextExpœeTime
, 
xR–ßdTime
;

519 
Li¡_t
 * 
pxTemp
;

520 
Tim”_t
 * 
pxTim”
;

521 
Ba£Ty³_t
 
xResuÉ
;

527  
	`li¡LIST_IS_EMPTY
Ğ
pxCu¼’tTim”Li¡
 ) =ğ
pdFALSE
 )

529 
xNextExpœeTime
 = 
	`li¡GET_ITEM_VALUE_OF_HEAD_ENTRY
Ğ
pxCu¼’tTim”Li¡
 );

532 
pxTim”
 = ( 
Tim”_t
 * ) 
	`li¡GET_OWNER_OF_HEAD_ENTRY
Ğ
pxCu¼’tTim”Li¡
 );

533 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

538 
pxTim”
->
	`pxC®lbackFunùiÚ
ĞĞ
Tim”HªdË_t
 )…xTimer );

540 ifĞĞ
pxTim”
->
ucStus
 & 
tmrSTATUS_IS_AUTORELOAD
 ) != 0 )

548 
xR–ßdTime
 = ( 
xNextExpœeTime
 + 
pxTim”
->
xTim”P”iodInTicks
 );

550 ifĞ
xR–ßdTime
 > 
xNextExpœeTime
 )

552 
	`li¡SET_LIST_ITEM_VALUE
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ), 
xR–ßdTime
 );

553 
	`li¡SET_LIST_ITEM_OWNER
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ),…xTimer );

554 
	`vLi¡In£¹
Ğ
pxCu¼’tTim”Li¡
, &Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

558 
xResuÉ
 = 
	`xTim”G’”icCommªd
Ğ
pxTim”
, 
tmrCOMMAND_START_DONT_TRACE
, 
xNextExpœeTime
, 
NULL
, 
tmrNO_DELAY
 );

559 Ğè
xResuÉ
;

564 
pxTemp
 = 
pxCu¼’tTim”Li¡
;

565 
pxCu¼’tTim”Li¡
 = 
pxOv”æowTim”Li¡
;

566 
pxOv”æowTim”Li¡
 = 
pxTemp
;

567 
	}
}

569 
Tim”HªdË_t
 
	$xTim”C»©e
ĞcÚ¡ * cÚ¡ 
pcTim”Name
,

570 cÚ¡ 
TickTy³_t
 
xTim”P”iodInTicks
,

571 cÚ¡ 
UBa£Ty³_t
 
uxAutoR–ßd
,

572 * cÚ¡ 
pvTim”ID
,

573 
Tim”C®lbackFunùiÚ_t
 
pxC®lbackFunùiÚ
 )

575 
Tim”_t
 * 
pxNewTim”
;

577 
pxNewTim”
 = ( 
Tim”_t
 * ) 
	`pvPÜtM®loc
( ( Timer_t ) );

579 ifĞ
pxNewTim”
 !ğ
NULL
 )

584 
pxNewTim”
->
ucStus
 = 0x00;

585 
	`´vIn™Ÿli£NewTim”
Ğ
pcTim”Name
, 
xTim”P”iodInTicks
, 
uxAutoR–ßd
, 
pvTim”ID
, 
pxC®lbackFunùiÚ
, 
pxNewTim”
 );

588  
pxNewTim”
;

589 
	}
}

591 
Ba£Ty³_t
 
	$xTim”C»©eTim”Task
( )

593 
Ba£Ty³_t
 
xR‘uº
 = 
pdFAIL
;

599 
	`´vCheckFÜV®idLi¡AndQueue
();

601 ifĞ
xTim”Queue
 !ğ
NULL
 )

603 #iàĞ
cÚfigSUPPORT_STATIC_ALLOCATION
 == 1 )

605 
SticTask_t
 * 
pxTim”TaskTCBBufãr
 = 
NULL
;

606 
SckTy³_t
 * 
pxTim”TaskSckBufãr
 = 
NULL
;

607 
ušt32_t
 
ulTim”TaskSckSize
;

609 
	`vAµliÿtiÚG‘Tim”TaskMemÜy
Ğ&
pxTim”TaskTCBBufãr
, &
pxTim”TaskSckBufãr
, &
ulTim”TaskSckSize
 );

610 
xTim”TaskHªdË
 = 
	`xTaskC»©eStic
Ğ
´vTim”Task
,

611 
cÚfigTIMER_SERVICE_TASK_NAME
,

612 
ulTim”TaskSckSize
,

613 
NULL
,

614 ĞĞ
UBa£Ty³_t
 ) 
cÚfigTIMER_TASK_PRIORITY
 ) | 
pÜtPRIVILEGE_BIT
,

615 
pxTim”TaskSckBufãr
,

616 
pxTim”TaskTCBBufãr
 );

618 ifĞ
xTim”TaskHªdË
 !ğ
NULL
 )

620 
xR‘uº
 = 
pdPASS
;

625 
xR‘uº
 = 
	`xTaskC»©e
Ğ
´vTim”Task
,

626 
cÚfigTIMER_SERVICE_TASK_NAME
,

627 
cÚfigTIMER_TASK_STACK_DEPTH
,

628 
NULL
,

629 ĞĞ
UBa£Ty³_t
 ) 
cÚfigTIMER_TASK_PRIORITY
 ) | 
pÜtPRIVILEGE_BIT
,

630 &
xTim”TaskHªdË
 );

636 
	`mtCOVERAGE_TEST_MARKER
();

639  
xR‘uº
;

640 
	}
}

641 
Ba£Ty³_t
 
	$xTim”G’”icCommªd
Ğ
Tim”HªdË_t
 
xTim”
,

642 cÚ¡ 
Ba£Ty³_t
 
xCommªdID
,

643 cÚ¡ 
TickTy³_t
 
xO±iÚ®V®ue
,

644 
Ba£Ty³_t
 * cÚ¡ 
pxHigh”PriÜ™yTaskWok’
,

645 cÚ¡ 
TickTy³_t
 
xTicksToWa™
 )

647 
Ba£Ty³_t
 
xR‘uº
 = 
pdFAIL
;

648 
D«mÚTaskMes§ge_t
 
xMes§ge
;

653 ifĞ
xTim”Queue
 !ğ
NULL
 )

656 
xMes§ge
.
xMes§geID
 = 
xCommªdID
;

657 
xMes§ge
.
u
.
xTim”P¬am‘”s
.
xMes§geV®ue
 = 
xO±iÚ®V®ue
;

658 
xMes§ge
.
u
.
xTim”P¬am‘”s
.
pxTim”
 = 
xTim”
;

660 ifĞ
xCommªdID
 < 
tmrFIRST_FROM_ISR_COMMAND
 )

662 ifĞ
	`xTaskG‘ScheduËrS‹
(è=ğ
skSCHEDULER_RUNNING
 )

664 
xR‘uº
 = 
	`xQueueS’dToBack
Ğ
xTim”Queue
, &
xMes§ge
, 
xTicksToWa™
 );

668 
xR‘uº
 = 
	`xQueueS’dToBack
Ğ
xTim”Queue
, &
xMes§ge
, 
tmrNO_DELAY
 );

673 
xR‘uº
 = 
	`xQueueS’dToBackFromISR
Ğ
xTim”Queue
, &
xMes§ge
, 
pxHigh”PriÜ™yTaskWok’
 );

678  
xR‘uº
;

679 
	}
}

681 
TickTy³_t
 
	$xTim”G‘ExpœyTime
Ğ
Tim”HªdË_t
 
xTim”
 )

683 
Tim”_t
 * 
pxTim”
 = 
xTim”
;

684 
TickTy³_t
 
xR‘uº
;

686 
xR‘uº
 = 
	`li¡GET_LIST_ITEM_VALUE
Ğ&Ğ
pxTim”
->
xTim”Li¡I‹m
 ) );

687  
xR‘uº
;

688 
	}
}

691 
	$´vS‘NextTim”IÁ”ru±
()

693 
__asm
 vŞ©e("ld0,0(%0)"::"r"
mtimecmp
);

694 
__asm
 vŞ©e("add0,t0,%0" :: "r"(
cÚfigTICK_CLOCK_HZ
 / 
cÚfigTICK_RATE_HZ
));

695 
__asm
 vŞ©e("sd0,0(%0)"::"r"
mtimecmp
);

696 
	}
}

701 
	$vPÜtS‘upTim”
()

703 
__asm
 vŞ©e("ld0,0(%0)"::"r"
mtime
);

704 
__asm
 vŞ©e("add0,t0,%0"::"r"(
cÚfigTICK_CLOCK_HZ
 / 
cÚfigTICK_RATE_HZ
));

705 
__asm
 vŞ©e("sd0,0(%0)"::"r"
mtimecmp
);

708 
__asm
 volatile("csrs mie,%0"::"r"(0x80));

709 
	}
}

711 
	$vPÜtSysTickHªdËr
( )

713 
	`´vS‘NextTim”IÁ”ru±
();

716 ifĞ
	`xTaskInüem’tTick
(è!ğ
pdFALSE
 )

718 
	`vTaskSw™chCÚ‹xt
();

720 
	}
}

721 
	$´vCheckFÜV®idLi¡AndQueue
( )

723 ifĞ
xTim”Queue
 =ğ
NULL
 )

725 
	`vLi¡In™Ÿli£
Ğ&
xAùiveTim”Li¡1
 );

726 
	`vLi¡In™Ÿli£
Ğ&
xAùiveTim”Li¡2
 );

727 
pxCu¼’tTim”Li¡
 = &
xAùiveTim”Li¡1
;

728 
pxOv”æowTim”Li¡
 = &
xAùiveTim”Li¡2
;

729 
xTim”Queue
 = 
	`xQueueC»©e
ĞĞ
UBa£Ty³_t
 ) 
cÚfigTIMER_QUEUE_LENGTH
, Ğ
D«mÚTaskMes§ge_t
 ) );

731 ifĞ
xTim”Queue
 !ğ
NULL
 )

733 
	`vQueueAddToRegi¡ry
Ğ
xTim”Queue
, "TmrQ" );

737 
	}
}

	@kernel/main.c

1 
	~<h—p.h
>

2 
	~<queue.h
>

3 
	~<commÚ.h
>

4 
	~<sk.h
>

5 
	~<time.h
>

7 
	#mašCHECK_TIMER_PERIOD_MS
 ( 3000UL / 
pÜtTICK_PERIOD_MS
 )

	)

8 
	#mašDONT_BLOCK
 ( 0UL )

	)

9 
Ba£Ty³_t
 
	gxD©a
 = 0;

10 
Te¡Prog¿m
();

11 
´vCheckTim”C®lback
();

12 
	$vSysÿÎIn™
()

14 
Tim”HªdË_t
 
xCheckTim”
 = 
NULL
;

16 
	`xTaskC»©e
Ğ
Te¡Prog¿m
, "Te¡Prog¿m", 4096, 
NULL
, 20, NULL );

18 
xCheckTim”
 = 
	`xTim”C»©e
Ğ"CheckTim”",Ğ
mašCHECK_TIMER_PERIOD_MS
 ),
pdTRUE
,Ğ* ) 0,
´vCheckTim”C®lback
);

20 ifĞ
xCheckTim”
 !ğ
NULL
 )

22 
	`xTim”S¹
Ğ
xCheckTim”
, 
mašDONT_BLOCK
 );

26 
	`vTaskS¹ScheduËr
();

27 
	}
}

29 
	$Te¡Prog¿m
()

32 
Ba£Ty³_t
 
a
 =1;

33 
QueueHªdË_t
 
‹¡queu‘
;

34 
‹¡queu‘
 = 
	`xQueueC»©e
Ğ
bktQUEUE_LENGTH
, Ğ
Ba£Ty³_t
 ) );

35 
	`xQueueS’d
(
‹¡queu‘
,&
a
,0);

36 ifĞ
	`xQueueReûive
Ğ
‹¡queu‘
, &
xD©a
, 0 ) !ğ
”rQUEUE_EMPTY
 )

40 
	}
}

41 
	$´vCheckTim”C®lback
()

43 
a
=0;

44 
	}
}

	@schedule/include/task.h

1 
	sxTIME_OUT


3 
Ba£Ty³_t
 
	mxOv”æowCouÁ
;

4 
TickTy³_t
 
	mxTimeOnEÁ”šg
;

5 } 
	tTimeOut_t
;

10 
	sxMEMORY_REGION


12 * 
	mpvBa£Add»ss
;

13 
ušt32_t
 
	mulL’gthInBy‹s
;

14 
ušt32_t
 
	mulP¬am‘”s
;

15 } 
	tMemÜyRegiÚ_t
;

	@schedule/src/task.c

1 
	~<sk.h
>

2 
	~<commÚ.h
>

3 
	#pÜtBYTE_ALIGNMENT_MASK
 (0x001f)

	)

4 vŞ©
Ba£Ty³_t
 
	gxScheduËrRuÂšg
 = 
pdFALSE
;

5 vŞ©
UBa£Ty³_t
 
	guxTİR—dyPriÜ™y
 = 
tskIDLE_PRIORITY
;

6 
Li¡_t
 
	gpxR—dyTasksLi¡s
[ 
cÚfigMAX_PRIORITIES
 ];

7 
Li¡_t
 
	gxD–ayedTaskLi¡1
;

8 
Li¡_t
 
	gxD–ayedTaskLi¡2
;

9 
Li¡_t
 * vŞ©
	gpxD–ayedTaskLi¡
;

10 
Li¡_t
 * vŞ©
	gpxOv”æowD–ayedTaskLi¡
;

11 
Li¡_t
 
	gxP’dšgR—dyLi¡
;

12 vŞ©
UBa£Ty³_t
 
	guxCu¼’tNumb”OfTasks
 = ( UBaseType_t ) 0U;

13 vŞ©
TickTy³_t
 
	gxTickCouÁ
 = ( TickType_t ) 0U;

15 
Li¡_t
 
	gxSu¥’dedTaskLi¡
;

17 vŞ©
UBa£Ty³_t
 
	guxP’dedTicks
 = ( UBaseType_t ) 0U;

18 vŞ©
Ba£Ty³_t
 
	gxY›ldP’dšg
 = 
pdFALSE
;

19 vŞ©
Ba£Ty³_t
 
	gxNumOfOv”æows
 = ( BaseType_t ) 0;

20 
UBa£Ty³_t
 
	guxTaskNumb”
 = ( UBaseType_t ) 0U;

21 vŞ©
TickTy³_t
 
	gxNextTaskUnblockTime
 = ( TickType_t ) 0U;

22 
TCB_t
 * vŞ©
	gpxCu¼’tTCB
 = 
NULL
;

26 
	#skSELECT_HIGHEST_PRIORITY_TASK
() \

28 
UBa£Ty³_t
 
uxTİPriÜ™y
 = 
uxTİR—dyPriÜ™y
; \

31  
	`li¡LIST_IS_EMPTY
Ğ&Ğ
pxR—dyTasksLi¡s
[ 
uxTİPriÜ™y
 ] ) ) ) \

33 --
uxTİPriÜ™y
; \

38 
	`li¡GET_OWNER_OF_NEXT_ENTRY
Ğ
pxCu¼’tTCB
, &Ğ
pxR—dyTasksLi¡s
[ 
uxTİPriÜ™y
 ] ) ); \

39 
uxTİR—dyPriÜ™y
 = 
uxTİPriÜ™y
; \

40 }

	)

42 
	#skRECORD_READY_PRIORITY
Ğ
uxPriÜ™y
 ) \

44 ifĞĞ
uxPriÜ™y
 ) > 
uxTİR—dyPriÜ™y
 ) \

46 
uxTİR—dyPriÜ™y
 = ( 
uxPriÜ™y
 ); \

48 }

	)

51 
	#´vAddTaskToR—dyLi¡
Ğ
pxTCB
 ) \

52 
	`skRECORD_READY_PRIORITY
ĞĞ
pxTCB
 )->
uxPriÜ™y
 ); \

53 
	`vLi¡In£¹End
Ğ&Ğ
pxR—dyTasksLi¡s
[ ( 
pxTCB
 )->
uxPriÜ™y
 ] ), &ĞĞpxTCB )->
xS‹Li¡I‹m
 ) ); \

54 

	)

55 
	$vTaskIÁ”ÇlS‘TimeOutS‹
Ğ
TimeOut_t
 * cÚ¡ 
pxTimeOut
 )

58 
pxTimeOut
->
xOv”æowCouÁ
 = 
xNumOfOv”æows
;

59 
pxTimeOut
->
xTimeOnEÁ”šg
 = 
xTickCouÁ
;

60 
	}
}

62 
Ba£Ty³_t
 
	$xTaskC»©e
Ğ
TaskFunùiÚ_t
 
pxTaskCode
,

63 cÚ¡ * cÚ¡ 
pcName
,

64 cÚ¡ 
cÚfigSTACK_DEPTH_TYPE
 
usSckD•th
,

65 * cÚ¡ 
pvP¬am‘”s
,

66 
UBa£Ty³_t
 
uxPriÜ™y
,

67 
TaskHªdË_t
 * cÚ¡ 
pxC»©edTask
 )

69 
TCB_t
 * 
pxNewTCB
;

70 
Ba£Ty³_t
 
xR‘uº
;

75 #iàĞ
pÜtSTACK_GROWTH
 > 0 )

80 
pxNewTCB
 = ( 
TCB_t
 * ) 
	`pvPÜtM®loc
( ( TCB_t ) );

82 ifĞ
pxNewTCB
 !ğ
NULL
 )

87 
pxNewTCB
->
pxSck
 = ( 
SckTy³_t
 * ) 
	`pvPÜtM®loc
ĞĞĞĞ
size_t
 ) 
usSckD•th
 ) * ( StackType_t ) ) );

89 ifĞ
pxNewTCB
->
pxSck
 =ğ
NULL
 )

92 
	`vPÜtF»e
Ğ
pxNewTCB
 );

93 
pxNewTCB
 = 
NULL
;

99 
SckTy³_t
 * 
pxSck
;

102 
pxSck
 = 
	`pvPÜtM®loc
ĞĞĞĞ
size_t
 ) 
usSckD•th
 ) * Ğ
SckTy³_t
 ) ) );

104 ifĞ
pxSck
 !ğ
NULL
 )

107 
pxNewTCB
 = ( 
TCB_t
 * ) 
	`pvPÜtM®loc
( ( TCB_t ) );

109 ifĞ
pxNewTCB
 !ğ
NULL
 )

112 
pxNewTCB
->
pxSck
 =…xStack;

118 
	`vPÜtF»e
Ğ
pxSck
 );

123 
pxNewTCB
 = 
NULL
;

128 ifĞ
pxNewTCB
 !ğ
NULL
 )

130 #iàĞ
tskSTATIC_AND_DYNAMIC_ALLOCATION_POSSIBLE
 != 0 )

134 
pxNewTCB
->
ucStiÿÎyAÎoÿ‹d
 = 
tskDYNAMICALLY_ALLOCATED_STACK_AND_TCB
;

138 
	`´vIn™Ÿli£NewTask
Ğ
pxTaskCode
, 
pcName
, ( 
ušt32_t
 ) 
usSckD•th
, 
pvP¬am‘”s
, 
uxPriÜ™y
, 
pxC»©edTask
, 
pxNewTCB
, 
NULL
 );

139 
	`´vAddNewTaskToR—dyLi¡
Ğ
pxNewTCB
 );

140 
xR‘uº
 = 
pdPASS
;

144 
xR‘uº
 = 
”rCOULD_NOT_ALLOCATE_REQUIRED_MEMORY
;

147  
xR‘uº
;

148 
	}
}

150 
	$´vIn™Ÿli£NewTask
Ğ
TaskFunùiÚ_t
 
pxTaskCode
,

151 cÚ¡ * cÚ¡ 
pcName
,

152 cÚ¡ 
ušt32_t
 
ulSckD•th
,

153 * cÚ¡ 
pvP¬am‘”s
,

154 
UBa£Ty³_t
 
uxPriÜ™y
,

155 
TaskHªdË_t
 * cÚ¡ 
pxC»©edTask
,

156 
TCB_t
 * 
pxNewTCB
,

157 cÚ¡ 
MemÜyRegiÚ_t
 * cÚ¡ 
xRegiÚs
 )

159 
SckTy³_t
 * 
pxTİOfSck
;

160 
UBa£Ty³_t
 
x
;

162 #iàĞ
pÜtUSING_MPU_WRAPPERS
 == 1 )

164 
Ba£Ty³_t
 
xRunPriveged
;

166 ifĞĞ
uxPriÜ™y
 & 
pÜtPRIVILEGE_BIT
 ) != 0U )

168 
xRunPriveged
 = 
pdTRUE
;

172 
xRunPriveged
 = 
pdFALSE
;

174 
uxPriÜ™y
 &ğ~
pÜtPRIVILEGE_BIT
;

178 #iàĞ
tskSET_NEW_STACKS_TO_KNOWN_VALUE
 == 1 )

181 Ğè
	`mem£t
Ğ
pxNewTCB
->
pxSck
, ( è
tskSTACK_FILL_BYTE
, ( 
size_t
 ) 
ulSckD•th
 * Ğ
SckTy³_t
 ) );

189 #iàĞ
pÜtSTACK_GROWTH
 < 0 )

191 
pxTİOfSck
 = &Ğ
pxNewTCB
->
pxSck
[ 
ulSckD•th
 - ( 
ušt32_t
 ) 1 ] );

192 
pxTİOfSck
 = ( 
SckTy³_t
 * ) ( ( ( 
pÜtPOINTER_SIZE_TYPE
 )…xTİOfSck ) & ( ~ĞĞpÜtPOINTER_SIZE_TYPE ) 
pÜtBYTE_ALIGNMENT_MASK
 ) ) );

196 #iàĞ
cÚfigRECORD_STACK_HIGH_ADDRESS
 == 1 )

200 
pxNewTCB
->
pxEndOfSck
 = 
pxTİOfSck
;

206 
pxTİOfSck
 = 
pxNewTCB
->
pxSck
;

211 
pxNewTCB
->
pxEndOfSck
 =…xNewTCB->
pxSck
 + ( 
ulSckD•th
 - ( 
ušt32_t
 ) 1 );

216 ifĞ
pcName
 !ğ
NULL
 )

218  
x
 = ( 
UBa£Ty³_t
 ) 0; x < ( UBa£Ty³_ˆè
cÚfigMAX_TASK_NAME_LEN
; x++ )

220 
pxNewTCB
->
pcTaskName
[ 
x
 ] = 
pcName
[ x ];

225 ifĞ
pcName
[ 
x
 ] == ( ) 0x00 )

231 
	`mtCOVERAGE_TEST_MARKER
();

237 
pxNewTCB
->
pcTaskName
[ 
cÚfigMAX_TASK_NAME_LEN
 - 1 ] = '\0';

243 
pxNewTCB
->
pcTaskName
[ 0 ] = 0x00;

248 ifĞ
uxPriÜ™y
 >ğĞ
UBa£Ty³_t
 ) 
cÚfigMAX_PRIORITIES
 )

250 
uxPriÜ™y
 = ( 
UBa£Ty³_t
 ) 
cÚfigMAX_PRIORITIES
 - ( UBaseType_t ) 1U;

254 
	`mtCOVERAGE_TEST_MARKER
();

257 
pxNewTCB
->
uxPriÜ™y
 = uxPriority;

258 #iàĞ
cÚfigUSE_MUTEXES
 == 1 )

260 
pxNewTCB
->
uxBa£PriÜ™y
 = 
uxPriÜ™y
;

261 
pxNewTCB
->
uxMu‹xesH–d
 = 0;

265 
	`vLi¡In™Ÿli£I‹m
Ğ&Ğ
pxNewTCB
->
xS‹Li¡I‹m
 ) );

266 
	`vLi¡In™Ÿli£I‹m
Ğ&Ğ
pxNewTCB
->
xEv’tLi¡I‹m
 ) );

270 
	`li¡SET_LIST_ITEM_OWNER
Ğ&Ğ
pxNewTCB
->
xS‹Li¡I‹m
 ),…xNewTCB );

273 
	`li¡SET_LIST_ITEM_VALUE
Ğ&Ğ
pxNewTCB
->
xEv’tLi¡I‹m
 ), ( 
TickTy³_t
 ) 
cÚfigMAX_PRIORITIES
 - ( TickTy³_ˆè
uxPriÜ™y
 );

274 
	`li¡SET_LIST_ITEM_OWNER
Ğ&Ğ
pxNewTCB
->
xEv’tLi¡I‹m
 ),…xNewTCB );

276 #iàĞ
pÜtCRITICAL_NESTING_IN_TCB
 == 1 )

278 
pxNewTCB
->
uxCr™iÿlNe¡šg
 = ( 
UBa£Ty³_t
 ) 0U;

282 #iàĞ
cÚfigUSE_APPLICATION_TASK_TAG
 == 1 )

284 
pxNewTCB
->
pxTaskTag
 = 
NULL
;

288 #iàĞ
cÚfigGENERATE_RUN_TIME_STATS
 == 1 )

290 
pxNewTCB
->
ulRunTimeCouÁ”
 = 0UL;

294 #iàĞ
pÜtUSING_MPU_WRAPPERS
 == 1 )

296 
	`vPÜtStÜeTaskMPUS‘tšgs
Ğ&Ğ
pxNewTCB
->
xMPUS‘tšgs
 ), 
xRegiÚs
,…xNewTCB->
pxSck
, 
ulSckD•th
 );

301 Ğè
xRegiÚs
;

305 #iàĞ
cÚfigNUM_THREAD_LOCAL_STORAGE_POINTERS
 != 0 )

307 
	`mem£t
ĞĞ* ) &Ğ
pxNewTCB
->
pvTh»adLoÿlStÜagePoš‹rs
[ 0 ] ), 0x00, (…xNewTCB->pvThreadLocalStoragePointers ) );

311 #iàĞ
cÚfigUSE_TASK_NOTIFICATIONS
 == 1 )

313 
	`mem£t
ĞĞ* ) &Ğ
pxNewTCB
->
ulNÙif›dV®ue
[ 0 ] ), 0x00, (…xNewTCB->ulNotifiedValue ) );

314 
	`mem£t
ĞĞ* ) &Ğ
pxNewTCB
->
ucNÙifyS‹
[ 0 ] ), 0x00, (…xNewTCB->ucNotifyState ) );

318 #iàĞ
cÚfigUSE_NEWLIB_REENTRANT
 == 1 )

323 
	`_REENT_INIT_PTR
ĞĞ&Ğ
pxNewTCB
->
xNewLib_»’t
 ) ) );

327 #iàĞ
INCLUDE_xTaskAbÜtD–ay
 == 1 )

329 
pxNewTCB
->
ucD–ayAbÜ‹d
 = 
pdFALSE
;

337 #iàĞ
pÜtUSING_MPU_WRAPPERS
 == 1 )

342 #iàĞ
pÜtHAS_STACK_OVERFLOW_CHECKING
 == 1 )

344 #iàĞ
pÜtSTACK_GROWTH
 < 0 )

346 
pxNewTCB
->
pxTİOfSck
 = 
	`pxPÜtIn™Ÿli£Sck
ĞpxTİOfSck,…xNewTCB->
pxSck
, 
pxTaskCode
, 
pvP¬am‘”s
, 
xRunPriveged
 );

350 
pxNewTCB
->
pxTİOfSck
 = 
	`pxPÜtIn™Ÿli£Sck
ĞpxTİOfSck,…xNewTCB->
pxEndOfSck
, 
pxTaskCode
, 
pvP¬am‘”s
, 
xRunPriveged
 );

356 
pxNewTCB
->
pxTİOfSck
 = 
	`pxPÜtIn™Ÿli£Sck
ĞpxTİOfSck, 
pxTaskCode
, 
pvP¬am‘”s
, 
xRunPriveged
 );

365 #iàĞ
pÜtHAS_STACK_OVERFLOW_CHECKING
 == 1 )

367 #iàĞ
pÜtSTACK_GROWTH
 < 0 )

369 
pxNewTCB
->
pxTİOfSck
 = 
	`pxPÜtIn™Ÿli£Sck
ĞpxTİOfSck,…xNewTCB->
pxSck
, 
pxTaskCode
, 
pvP¬am‘”s
 );

373 
pxNewTCB
->
pxTİOfSck
 = 
	`pxPÜtIn™Ÿli£Sck
ĞpxTİOfSck,…xNewTCB->
pxEndOfSck
, 
pxTaskCode
, 
pvP¬am‘”s
 );

379 
pxNewTCB
->
pxTİOfSck
 = 
	`pxPÜtIn™Ÿli£Sck
ĞpxTİOfSck, 
pxTaskCode
, 
pvP¬am‘”s
 );

385 ifĞ
pxC»©edTask
 !ğ
NULL
 )

389 *
pxC»©edTask
 = ( 
TaskHªdË_t
 ) 
pxNewTCB
;

393 
	`mtCOVERAGE_TEST_MARKER
();

395 
	}
}

397 
	$´vAddNewTaskToR—dyLi¡
Ğ
TCB_t
 * 
pxNewTCB
 )

401 
	`skENTER_CRITICAL
();

403 
uxCu¼’tNumb”OfTasks
++;

405 ifĞ
pxCu¼’tTCB
 =ğ
NULL
 )

409 
pxCu¼’tTCB
 = 
pxNewTCB
;

411 ifĞ
uxCu¼’tNumb”OfTasks
 =ğĞ
UBa£Ty³_t
 ) 1 )

416 
	`´vIn™Ÿli£TaskLi¡s
();

420 
	`mtCOVERAGE_TEST_MARKER
();

428 ifĞ
xScheduËrRuÂšg
 =ğ
pdFALSE
 )

430 ifĞ
pxCu¼’tTCB
->
uxPriÜ™y
 <ğ
pxNewTCB
->uxPriority )

432 
pxCu¼’tTCB
 = 
pxNewTCB
;

436 
	`mtCOVERAGE_TEST_MARKER
();

441 
	`mtCOVERAGE_TEST_MARKER
();

445 
uxTaskNumb”
++;

447 #iàĞ
cÚfigUSE_TRACE_FACILITY
 == 1 )

450 
pxNewTCB
->
uxTCBNumb”
 = 
uxTaskNumb”
;

453 
	`ŒaûTASK_CREATE
Ğ
pxNewTCB
 );

455 
	`´vAddTaskToR—dyLi¡
Ğ
pxNewTCB
 );

458 
	`skEXIT_CRITICAL
();

460 ifĞ
xScheduËrRuÂšg
 !ğ
pdFALSE
 )

464 ifĞ
pxCu¼’tTCB
->
uxPriÜ™y
 < 
pxNewTCB
->uxPriority )

466 
	`skYIELD_IF_USING_PREEMPTION
();

470 
	`mtCOVERAGE_TEST_MARKER
();

475 
	`mtCOVERAGE_TEST_MARKER
();

477 
	}
}

479 
	$´vIn™Ÿli£TaskLi¡s
( )

481 
UBa£Ty³_t
 
uxPriÜ™y
;

483  
uxPriÜ™y
 = ( 
UBa£Ty³_t
 ) 0U; uxPriÜ™y < ( UBa£Ty³_ˆè
cÚfigMAX_PRIORITIES
; uxPriority++ )

485 
	`vLi¡In™Ÿli£
Ğ&Ğ
pxR—dyTasksLi¡s
[ 
uxPriÜ™y
 ] ) );

488 
	`vLi¡In™Ÿli£
Ğ&
xD–ayedTaskLi¡1
 );

489 
	`vLi¡In™Ÿli£
Ğ&
xD–ayedTaskLi¡2
 );

490 
	`vLi¡In™Ÿli£
Ğ&
xP’dšgR—dyLi¡
 );

492 #iàĞ
INCLUDE_vTaskD–‘e
 == 1 )

494 
	`vLi¡In™Ÿli£
Ğ&
xTasksWa™šgT”mš©iÚ
 );

498 #iàĞ
INCLUDE_vTaskSu¥’d
 == 1 )

500 
	`vLi¡In™Ÿli£
Ğ&
xSu¥’dedTaskLi¡
 );

506 
pxD–ayedTaskLi¡
 = &
xD–ayedTaskLi¡1
;

507 
pxOv”æowD–ayedTaskLi¡
 = &
xD–ayedTaskLi¡2
;

508 
	}
}

511 
	$vTaskSw™chCÚ‹xt
( )

513 ifĞ
uxScheduËrSu¥’ded
 !ğĞ
UBa£Ty³_t
 ) 
pdFALSE
 )

517 
xY›ldP’dšg
 = 
pdTRUE
;

521 
xY›ldP’dšg
 = 
pdFALSE
;

522 
	`ŒaûTASK_SWITCHED_OUT
();

524 #iàĞ
cÚfigGENERATE_RUN_TIME_STATS
 == 1 )

526 #ifdeà
pÜtALT_GET_RUN_TIME_COUNTER_VALUE


527 
	`pÜtALT_GET_RUN_TIME_COUNTER_VALUE
Ğ
ulTÙ®RunTime
 );

529 
ulTÙ®RunTime
 = 
	`pÜtGET_RUN_TIME_COUNTER_VALUE
();

539 ifĞ
ulTÙ®RunTime
 > 
ulTaskSw™chedInTime
 )

541 
pxCu¼’tTCB
->
ulRunTimeCouÁ”
 +ğĞ
ulTÙ®RunTime
 - 
ulTaskSw™chedInTime
 );

545 
	`mtCOVERAGE_TEST_MARKER
();

548 
ulTaskSw™chedInTime
 = 
ulTÙ®RunTime
;

553 
	`skCHECK_FOR_STACK_OVERFLOW
();

556 #iàĞ
cÚfigUSE_POSIX_ERRNO
 == 1 )

558 
pxCu¼’tTCB
->
iTaskE¼no
 = 
F»eRTOS_”ºo
;

564 
	`skSELECT_HIGHEST_PRIORITY_TASK
();

565 
	`ŒaûTASK_SWITCHED_IN
();

568 #iàĞ
cÚfigUSE_POSIX_ERRNO
 == 1 )

570 
F»eRTOS_”ºo
 = 
pxCu¼’tTCB
->
iTaskE¼no
;

574 #iàĞ
cÚfigUSE_NEWLIB_REENTRANT
 == 1 )

580 
_impu»_±r
 = &Ğ
pxCu¼’tTCB
->
xNewLib_»’t
 );

584 
	}
}

586 
	$vTaskS¹ScheduËr
( )

588 
Ba£Ty³_t
 
xR‘uº
;

591 #iàĞ
cÚfigSUPPORT_STATIC_ALLOCATION
 == 1 )

593 
SticTask_t
 * 
pxIdËTaskTCBBufãr
 = 
NULL
;

594 
SckTy³_t
 * 
pxIdËTaskSckBufãr
 = 
NULL
;

595 
ušt32_t
 
ulIdËTaskSckSize
;

599 
	`vAµliÿtiÚG‘IdËTaskMemÜy
Ğ&
pxIdËTaskTCBBufãr
, &
pxIdËTaskSckBufãr
, &
ulIdËTaskSckSize
 );

600 
xIdËTaskHªdË
 = 
	`xTaskC»©eStic
Ğ
´vIdËTask
,

601 
cÚfigIDLE_TASK_NAME
,

602 
ulIdËTaskSckSize
,

603 Ğ* ) 
NULL
,

604 
pÜtPRIVILEGE_BIT
,

605 
pxIdËTaskSckBufãr
,

606 
pxIdËTaskTCBBufãr
 );

608 ifĞ
xIdËTaskHªdË
 !ğ
NULL
 )

610 
xR‘uº
 = 
pdPASS
;

614 
xR‘uº
 = 
pdFAIL
;

620 
xR‘uº
 = 
	`xTaskC»©e
Ğ
´vIdËTask
,

621 
cÚfigIDLE_TASK_NAME
,

622 
cÚfigMINIMAL_STACK_SIZE
,

623 Ğ* ) 
NULL
,

624 
pÜtPRIVILEGE_BIT
,

625 &
xIdËTaskHªdË
 );

629 #iàĞ
cÚfigUSE_TIMERS
 == 1 )

631 ifĞ
xR‘uº
 =ğ
pdPASS
 )

633 
xR‘uº
 = 
	`xTim”C»©eTim”Task
();

637 
	`mtCOVERAGE_TEST_MARKER
();

642 ifĞ
xR‘uº
 =ğ
pdPASS
 )

647 #ifdeà
FREERTOS_TASKS_C_ADDITIONS_INIT


649 
	`ä“¹os_sks_c_add™iÚs_š™
();

658 
	`pÜtDISABLE_INTERRUPTS
();

660 #iàĞ
cÚfigUSE_NEWLIB_REENTRANT
 == 1 )

666 
_impu»_±r
 = &Ğ
pxCu¼’tTCB
->
xNewLib_»’t
 );

670 
xNextTaskUnblockTime
 = 
pÜtMAX_DELAY
;

671 
xScheduËrRuÂšg
 = 
pdTRUE
;

672 
xTickCouÁ
 = ( 
TickTy³_t
 ) 
cÚfigINITIAL_TICK_COUNT
;

680 
	`pÜtCONFIGURE_TIMER_FOR_RUN_TIME_STATS
();

682 
	`ŒaûTASK_SWITCHED_IN
();

686 ifĞ
	`xPÜtS¹ScheduËr
(è!ğ
pdFALSE
 )

705 Ğè
xIdËTaskHªdË
;

706 
	}
}

708 
Ba£Ty³_t
 
	$xTaskRemoveFromEv’tLi¡
ĞcÚ¡ 
Li¡_t
 * cÚ¡ 
pxEv’tLi¡
 )

710 
TCB_t
 * 
pxUnblockedTCB
;

711 
Ba£Ty³_t
 
xR‘uº
;

726 
pxUnblockedTCB
 = 
	`li¡GET_OWNER_OF_HEAD_ENTRY
Ğ
pxEv’tLi¡
 );

727 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxUnblockedTCB
->
xEv’tLi¡I‹m
 ) );

729 ifĞ
uxScheduËrSu¥’ded
 =ğĞ
UBa£Ty³_t
 ) 
pdFALSE
 )

731 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxUnblockedTCB
->
xS‹Li¡I‹m
 ) );

732 
	`´vAddTaskToR—dyLi¡
Ğ
pxUnblockedTCB
 );

734 #iàĞ
cÚfigUSE_TICKLESS_IDLE
 != 0 )

744 
	`´vRe£tNextTaskUnblockTime
();

752 
	`vLi¡In£¹End
Ğ&Ğ
xP’dšgR—dyLi¡
 ), &Ğ
pxUnblockedTCB
->
xEv’tLi¡I‹m
 ) );

755 ifĞ
pxUnblockedTCB
->
uxPriÜ™y
 > 
pxCu¼’tTCB
->uxPriority )

760 
xR‘uº
 = 
pdTRUE
;

764 
xY›ldP’dšg
 = 
pdTRUE
;

768 
xR‘uº
 = 
pdFALSE
;

771  
xR‘uº
;

772 
	}
}

774 
Ba£Ty³_t
 
	$xTaskCheckFÜTimeOut
Ğ
TimeOut_t
 * cÚ¡ 
pxTimeOut
,

775 
TickTy³_t
 * cÚ¡ 
pxTicksToWa™
 )

777 
Ba£Ty³_t
 
xR‘uº
;

780 
	`skENTER_CRITICAL
();

783 cÚ¡ 
TickTy³_t
 
xCÚ¡TickCouÁ
 = 
xTickCouÁ
;

784 cÚ¡ 
TickTy³_t
 
xEÏp£dTime
 = 
xCÚ¡TickCouÁ
 - 
pxTimeOut
->
xTimeOnEÁ”šg
;

786 #iàĞ
INCLUDE_xTaskAbÜtD–ay
 == 1 )

787 ifĞ
pxCu¼’tTCB
->
ucD–ayAbÜ‹d
 !ğĞ
ušt8_t
 ) 
pdFALSE
 )

791 
pxCu¼’tTCB
->
ucD–ayAbÜ‹d
 = 
pdFALSE
;

792 
xR‘uº
 = 
pdTRUE
;

797 #iàĞ
INCLUDE_vTaskSu¥’d
 == 1 )

798 ifĞ*
pxTicksToWa™
 =ğ
pÜtMAX_DELAY
 )

803 
xR‘uº
 = 
pdFALSE
;

808 ifĞĞ
xNumOfOv”æows
 !ğ
pxTimeOut
->
xOv”æowCouÁ
 ) && ( 
xCÚ¡TickCouÁ
 >ğpxTimeOut->
xTimeOnEÁ”šg
 ) )

815 
xR‘uº
 = 
pdTRUE
;

816 *
pxTicksToWa™
 = ( 
TickTy³_t
 ) 0;

818 ifĞ
xEÏp£dTime
 < *
pxTicksToWa™
 )

821 *
pxTicksToWa™
 -ğ
xEÏp£dTime
;

822 
	`vTaskIÁ”ÇlS‘TimeOutS‹
Ğ
pxTimeOut
 );

823 
xR‘uº
 = 
pdFALSE
;

827 *
pxTicksToWa™
 = ( 
TickTy³_t
 ) 0;

828 
xR‘uº
 = 
pdTRUE
;

831 
	`skEXIT_CRITICAL
();

833  
xR‘uº
;

834 
	}
}

837 
	$vTaskPÏûOnEv’tLi¡
Ğ
Li¡_t
 * cÚ¡ 
pxEv’tLi¡
,

838 cÚ¡ 
TickTy³_t
 
xTicksToWa™
 )

848 
	`vLi¡In£¹
Ğ
pxEv’tLi¡
, &Ğ
pxCu¼’tTCB
->
xEv’tLi¡I‹m
 ) );

850 
	`´vAddCu¼’tTaskToD–ayedLi¡
Ğ
xTicksToWa™
, 
pdTRUE
 );

851 
	}
}

855 
	$´vAddCu¼’tTaskToD–ayedLi¡
Ğ
TickTy³_t
 
xTicksToWa™
,

856 cÚ¡ 
Ba£Ty³_t
 
xCªBlockIndefš™–y
 )

858 
TickTy³_t
 
xTimeToWake
;

859 cÚ¡ 
TickTy³_t
 
xCÚ¡TickCouÁ
 = 
xTickCouÁ
;

861 #iàĞ
INCLUDE_xTaskAbÜtD–ay
 == 1 )

866 
pxCu¼’tTCB
->
ucD–ayAbÜ‹d
 = 
pdFALSE
;

872 ifĞ
	`uxLi¡Remove
Ğ&Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ) ) =ğĞ
UBa£Ty³_t
 ) 0 )

876 
	`pÜtRESET_READY_PRIORITY
Ğ
pxCu¼’tTCB
->
uxPriÜ™y
, 
uxTİR—dyPriÜ™y
 );

879 #iàĞ
INCLUDE_vTaskSu¥’d
 == 1 )

881 ifĞĞ
xTicksToWa™
 =ğ
pÜtMAX_DELAY
 ) && ( 
xCªBlockIndefš™–y
 !ğ
pdFALSE
 ) )

886 
	`vLi¡In£¹End
Ğ&
xSu¥’dedTaskLi¡
, &Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ) );

893 
xTimeToWake
 = 
xCÚ¡TickCouÁ
 + 
xTicksToWa™
;

896 
	`li¡SET_LIST_ITEM_VALUE
Ğ&Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ), 
xTimeToWake
 );

898 ifĞ
xTimeToWake
 < 
xCÚ¡TickCouÁ
 )

902 
	`vLi¡In£¹
Ğ
pxOv”æowD–ayedTaskLi¡
, &Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ) );

908 
	`vLi¡In£¹
Ğ
pxD–ayedTaskLi¡
, &Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ) );

913 ifĞ
xTimeToWake
 < 
xNextTaskUnblockTime
 )

915 
xNextTaskUnblockTime
 = 
xTimeToWake
;

919 
	`mtCOVERAGE_TEST_MARKER
();

929 
xTimeToWake
 = 
xCÚ¡TickCouÁ
 + 
xTicksToWa™
;

932 
	`li¡SET_LIST_ITEM_VALUE
Ğ&Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ), 
xTimeToWake
 );

934 ifĞ
xTimeToWake
 < 
xCÚ¡TickCouÁ
 )

937 
	`vLi¡In£¹
Ğ
pxOv”æowD–ayedTaskLi¡
, &Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ) );

942 
	`vLi¡In£¹
Ğ
pxD–ayedTaskLi¡
, &Ğ
pxCu¼’tTCB
->
xS‹Li¡I‹m
 ) );

947 ifĞ
xTimeToWake
 < 
xNextTaskUnblockTime
 )

949 
xNextTaskUnblockTime
 = 
xTimeToWake
;

956 
	}
}

959 
Ba£Ty³_t
 
	$xTaskInüem’tTick
( )

961 
TCB_t
 * 
pxTCB
;

962 
TickTy³_t
 
xI‹mV®ue
;

963 
Ba£Ty³_t
 
xSw™chRequœed
 = 
pdFALSE
;

968 
	`ŒaûTASK_INCREMENT_TICK
Ğ
xTickCouÁ
 );

970 ifĞ
uxScheduËrSu¥’ded
 =ğĞ
UBa£Ty³_t
 ) 
pdFALSE
 )

974 cÚ¡ 
TickTy³_t
 
xCÚ¡TickCouÁ
 = 
xTickCouÁ
 + ( TickType_t ) 1;

978 
xTickCouÁ
 = 
xCÚ¡TickCouÁ
;

980 ifĞ
xCÚ¡TickCouÁ
 =ğĞ
TickTy³_t
 ) 0U )

982 
	`skSWITCH_DELAYED_LISTS
();

986 
	`mtCOVERAGE_TEST_MARKER
();

993 ifĞ
xCÚ¡TickCouÁ
 >ğ
xNextTaskUnblockTime
 )

997 ifĞ
	`li¡LIST_IS_EMPTY
Ğ
pxD–ayedTaskLi¡
 ) !ğ
pdFALSE
 )

1004 
xNextTaskUnblockTime
 = 
pÜtMAX_DELAY
;

1013 
pxTCB
 = 
	`li¡GET_OWNER_OF_HEAD_ENTRY
Ğ
pxD–ayedTaskLi¡
 );

1014 
xI‹mV®ue
 = 
	`li¡GET_LIST_ITEM_VALUE
Ğ&Ğ
pxTCB
->
xS‹Li¡I‹m
 ) );

1016 ifĞ
xCÚ¡TickCouÁ
 < 
xI‹mV®ue
 )

1023 
xNextTaskUnblockTime
 = 
xI‹mV®ue
;

1028 
	`mtCOVERAGE_TEST_MARKER
();

1032 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxTCB
->
xS‹Li¡I‹m
 ) );

1036 ifĞ
	`li¡LIST_ITEM_CONTAINER
Ğ&Ğ
pxTCB
->
xEv’tLi¡I‹m
 ) ) !ğ
NULL
 )

1038 Ğè
	`uxLi¡Remove
Ğ&Ğ
pxTCB
->
xEv’tLi¡I‹m
 ) );

1042 
	`mtCOVERAGE_TEST_MARKER
();

1047 
	`´vAddTaskToR—dyLi¡
Ğ
pxTCB
 );

1051 #iàĞ
cÚfigUSE_PREEMPTION
 == 1 )

1057 ifĞ
pxTCB
->
uxPriÜ™y
 >ğ
pxCu¼’tTCB
->uxPriority )

1059 
xSw™chRequœed
 = 
pdTRUE
;

1063 
	`mtCOVERAGE_TEST_MARKER
();

1074 #iàĞĞ
cÚfigUSE_PREEMPTION
 =ğ1 ) && ( 
cÚfigUSE_TIME_SLICING
 == 1 ) )

1076 ifĞ
	`li¡CURRENT_LIST_LENGTH
Ğ&Ğ
pxR—dyTasksLi¡s
[ 
pxCu¼’tTCB
->
uxPriÜ™y
 ] ) ) > ( 
UBa£Ty³_t
 ) 1 )

1078 
xSw™chRequœed
 = 
pdTRUE
;

1082 
	`mtCOVERAGE_TEST_MARKER
();

1087 #iàĞ
cÚfigUSE_TICK_HOOK
 == 1 )

1091 ifĞ
xP’dedTicks
 =ğĞ
TickTy³_t
 ) 0 )

1093 
	`vAµliÿtiÚTickHook
();

1097 
	`mtCOVERAGE_TEST_MARKER
();

1102 #iàĞ
cÚfigUSE_PREEMPTION
 == 1 )

1104 ifĞ
xY›ldP’dšg
 !ğ
pdFALSE
 )

1106 
xSw™chRequœed
 = 
pdTRUE
;

1110 
	`mtCOVERAGE_TEST_MARKER
();

1117 ++
xP’dedTicks
;

1121 #iàĞ
cÚfigUSE_TICK_HOOK
 == 1 )

1123 
	`vAµliÿtiÚTickHook
();

1128  
xSw™chRequœed
;

1129 
	}
}

1131 
TickTy³_t
 
	$xTaskG‘TickCouÁ
( )

1133 
TickTy³_t
 
xTicks
;

1136 
	`pÜtTICK_TYPE_ENTER_CRITICAL
();

1138 
xTicks
 = 
xTickCouÁ
;

1140 
	`pÜtTICK_TYPE_EXIT_CRITICAL
();

1142  
xTicks
;

1143 
	}
}

1145 
Ba£Ty³_t
 
	$xTaskG‘ScheduËrS‹
( )

1147 
Ba£Ty³_t
 
xR‘uº
;

1149 ifĞ
xScheduËrRuÂšg
 =ğ
pdFALSE
 )

1151 
xR‘uº
 = 
skSCHEDULER_NOT_STARTED
;

1155 ifĞ
uxScheduËrSu¥’ded
 =ğĞ
UBa£Ty³_t
 ) 
pdFALSE
 )

1157 
xR‘uº
 = 
skSCHEDULER_RUNNING
;

1161 
xR‘uº
 = 
skSCHEDULER_SUSPENDED
;

1165  
xR‘uº
;

1166 
	}
}

1168 
	$pÜtTASK_FUNCTION
Ğ
´vIdËTask
, 
pvP¬am‘”s
 )

1172 ifĞ
	`li¡CURRENT_LIST_LENGTH
Ğ&Ğ
pxR—dyTasksLi¡s
[ 
tskIDLE_PRIORITY
 ] ) ) > ( 
UBa£Ty³_t
 ) 1 )

1174 
	`skYIELD
();

1177 
	}
}

	@/usr/include/time.h

22 #iâdef 
_TIME_H


23 
	#_TIME_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 
	#__Ãed_NULL


	)

29 
	~<¡ddef.h
>

33 
	~<b™s/time.h
>

37 
	~<b™s/ty³s/şock_t.h
>

38 
	~<b™s/ty³s/time_t.h
>

39 
	~<b™s/ty³s/¡ruù_tm.h
>

41 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_ISOC11


42 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

45 #ifdeà
__USE_POSIX199309


46 
	~<b™s/ty³s/şockid_t.h
>

47 
	~<b™s/ty³s/tim”_t.h
>

48 
	~<b™s/ty³s/¡ruù_™im”¥ec.h
>

49 
	gsigev’t
;

52 #ifdeà
__USE_XOPEN2K


53 #iâdeà
__pid_t_defšed


54 
__pid_t
 
	tpid_t
;

55 
	#__pid_t_defšed


	)

59 #ifdeà
__USE_XOPEN2K8


60 
	~<b™s/ty³s/loÿË_t.h
>

63 #ifdeà
__USE_ISOC11


65 
	#TIME_UTC
 1

	)

68 
__BEGIN_DECLS


72 
şock_t
 
	$şock
 (è
__THROW
;

75 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

78 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

79 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

82 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

88 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

89 cÚ¡ *
__»¡riù
 
__fÜm©
,

90 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

92 #ifdeà
__USE_XOPEN


95 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

96 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

97 
__THROW
;

100 #ifdeà
__USE_XOPEN2K8


104 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

105 cÚ¡ *
__»¡riù
 
__fÜm©
,

106 cÚ¡ 
tm
 *
__»¡riù
 
__
,

107 
loÿË_t
 
__loc
è
__THROW
;

110 #ifdeà
__USE_GNU


111 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

112 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

113 
loÿË_t
 
__loc
è
__THROW
;

119 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

123 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

125 #ià
defšed
 
__USE_POSIX
 || 
	`__GLIBC_USE
 (
ISOC2X
)

128 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

129 
tm
 *
__»¡riù
 
__
è
__THROW
;

133 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

134 
tm
 *
__»¡riù
 
__
è
__THROW
;

139 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

142 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

144 #ià
defšed
 
__USE_POSIX
 || 
	`__GLIBC_USE
 (
ISOC2X
)

149 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

150 *
__»¡riù
 
__buf
è
__THROW
;

153 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

154 *
__»¡riù
 
__buf
è
__THROW
;

159 *
__tzÇme
[2];

160 
__daylight
;

161 
__timezÚe
;

164 #ifdef 
__USE_POSIX


166 *
tzÇme
[2];

170 
	$tz£t
 (è
__THROW
;

173 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


174 
daylight
;

175 
timezÚe
;

181 
	#__i¦—p
(
y—r
) \

182 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

185 #ifdeà
__USE_MISC


190 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

193 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

196 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

200 #ifdeà
__USE_POSIX199309


205 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

206 
time¥ec
 *
__»maššg
);

210 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

213 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

216 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

217 
__THROW
;

219 #ifdeà
__USE_XOPEN2K


224 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

225 cÚ¡ 
time¥ec
 *
__»q
,

226 
time¥ec
 *
__»m
);

229 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

234 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

235 
sigev’t
 *
__»¡riù
 
__evp
,

236 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

239 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

242 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

243 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

244 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

247 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

248 
__THROW
;

251 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

255 #ifdeà
__USE_ISOC11


257 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

258 
__THROW
 
	`__nÚnuÎ
 ((1));

262 #ifdeà
__USE_XOPEN_EXTENDED


274 
g‘d©e_”r
;

283 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

286 #ifdeà
__USE_GNU


297 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

298 
tm
 *
__»¡riù
 
__»sbuå
);

301 
__END_DECLS


	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

120 #undeà
__USE_ISOC11


121 #undeà
__USE_ISOC99


122 #undeà
__USE_ISOC95


123 #undeà
__USE_ISOCXX11


124 #undeà
__USE_POSIX


125 #undeà
__USE_POSIX2


126 #undeà
__USE_POSIX199309


127 #undeà
__USE_POSIX199506


128 #undeà
__USE_XOPEN


129 #undeà
__USE_XOPEN_EXTENDED


130 #undeà
__USE_UNIX98


131 #undeà
__USE_XOPEN2K


132 #undeà
__USE_XOPEN2KXSI


133 #undeà
__USE_XOPEN2K8


134 #undeà
__USE_XOPEN2K8XSI


135 #undeà
__USE_LARGEFILE


136 #undeà
__USE_LARGEFILE64


137 #undeà
__USE_FILE_OFFSET64


138 #undeà
__USE_MISC


139 #undeà
__USE_ATFILE


140 #undeà
__USE_GNU


141 #undeà
__USE_FORTIFY_LEVEL


142 #undeà
__KERNEL_STRICT_NAMES


143 #undeà
__GLIBC_USE_ISOC2X


144 #undeà
__GLIBC_USE_DEPRECATED_GETS


145 #undeà
__GLIBC_USE_DEPRECATED_SCANF


149 #iâdeà
_LOOSE_KERNEL_NAMES


150 
	#__KERNEL_STRICT_NAMES


	)

160 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


161 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

162 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

164 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

171 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


172 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

173 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

175 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

179 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

185 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

186 && !
defšed
 
	g_DEFAULT_SOURCE


188 #undeà
_DEFAULT_SOURCE


189 
	#_DEFAULT_SOURCE
 1

	)

193 #ifdeà
_GNU_SOURCE


194 #undeà
_ISOC95_SOURCE


195 
	#_ISOC95_SOURCE
 1

	)

196 #undeà
_ISOC99_SOURCE


197 
	#_ISOC99_SOURCE
 1

	)

198 #undeà
_ISOC11_SOURCE


199 
	#_ISOC11_SOURCE
 1

	)

200 #undeà
_ISOC2X_SOURCE


201 
	#_ISOC2X_SOURCE
 1

	)

202 #undeà
_POSIX_SOURCE


203 
	#_POSIX_SOURCE
 1

	)

204 #undeà
_POSIX_C_SOURCE


205 
	#_POSIX_C_SOURCE
 200809L

	)

206 #undeà
_XOPEN_SOURCE


207 
	#_XOPEN_SOURCE
 700

	)

208 #undeà
_XOPEN_SOURCE_EXTENDED


209 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

210 #undeà
_LARGEFILE64_SOURCE


211 
	#_LARGEFILE64_SOURCE
 1

	)

212 #undeà
_DEFAULT_SOURCE


213 
	#_DEFAULT_SOURCE
 1

	)

214 #undeà
_ATFILE_SOURCE


215 
	#_ATFILE_SOURCE
 1

	)

220 #ià(
defšed
 
_DEFAULT_SOURCE
 \

221 || (!
defšed
 
	g__STRICT_ANSI__
 \

222 && !
defšed
 
	g_ISOC99_SOURCE
 && !defšed 
	g_ISOC11_SOURCE
 \

223 && !
defšed
 
	g_ISOC2X_SOURCE
 \

224 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

225 && !
defšed
 
	g_XOPEN_SOURCE
))

226 #undeà
_DEFAULT_SOURCE


227 
	#_DEFAULT_SOURCE
 1

	)

231 #ià(
defšed
 
_ISOC2X_SOURCE
 \

232 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ > 201710L))

233 
	#__GLIBC_USE_ISOC2X
 1

	)

235 
	#__GLIBC_USE_ISOC2X
 0

	)

239 #ià(
defšed
 
_ISOC11_SOURCE
 || defšed 
_ISOC2X_SOURCE
 \

240 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

241 
	#__USE_ISOC11
 1

	)

245 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

246 || 
defšed
 
_ISOC2X_SOURCE
 \

247 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

248 
	#__USE_ISOC99
 1

	)

252 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

253 || 
defšed
 
_ISOC2X_SOURCE
 \

254 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

255 
	#__USE_ISOC95
 1

	)

258 #ifdeà
__ılu¥lus


260 #ià
__ılu¥lus
 >= 201703L

261 
	#__USE_ISOC11
 1

	)

265 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


266 
	#__USE_ISOCXX11
 1

	)

267 
	#__USE_ISOC99
 1

	)

274 #ifdeà
_DEFAULT_SOURCE


275 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


276 
	#__USE_POSIX_IMPLICITLY
 1

	)

278 #undeà
_POSIX_SOURCE


279 
	#_POSIX_SOURCE
 1

	)

280 #undeà
_POSIX_C_SOURCE


281 
	#_POSIX_C_SOURCE
 200809L

	)

284 #ià((!
defšed
 
__STRICT_ANSI__
 \

285 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

286 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

287 
	#_POSIX_SOURCE
 1

	)

288 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

289 
	#_POSIX_C_SOURCE
 2

	)

290 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

291 
	#_POSIX_C_SOURCE
 199506L

	)

292 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

293 
	#_POSIX_C_SOURCE
 200112L

	)

295 
	#_POSIX_C_SOURCE
 200809L

	)

297 
	#__USE_POSIX_IMPLICITLY
 1

	)

306 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

307 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

308 
	#_POSIX_SOURCE
 1

	)

309 #undeà
_POSIX_C_SOURCE


310 
	#_POSIX_C_SOURCE
 199506L

	)

313 #ià(
defšed
 
_POSIX_SOURCE
 \

314 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

315 || 
defšed
 
_XOPEN_SOURCE
)

316 
	#__USE_POSIX
 1

	)

319 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


320 
	#__USE_POSIX2
 1

	)

323 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

324 
	#__USE_POSIX199309
 1

	)

327 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

328 
	#__USE_POSIX199506
 1

	)

331 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

332 
	#__USE_XOPEN2K
 1

	)

333 #undeà
__USE_ISOC95


334 
	#__USE_ISOC95
 1

	)

335 #undeà
__USE_ISOC99


336 
	#__USE_ISOC99
 1

	)

339 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

340 
	#__USE_XOPEN2K8
 1

	)

341 #undeà
_ATFILE_SOURCE


342 
	#_ATFILE_SOURCE
 1

	)

345 #ifdef 
_XOPEN_SOURCE


346 
	#__USE_XOPEN
 1

	)

347 #ià(
_XOPEN_SOURCE
 - 0) >= 500

348 
	#__USE_XOPEN_EXTENDED
 1

	)

349 
	#__USE_UNIX98
 1

	)

350 #undeà
_LARGEFILE_SOURCE


351 
	#_LARGEFILE_SOURCE
 1

	)

352 #ià(
_XOPEN_SOURCE
 - 0) >= 600

353 #ià(
_XOPEN_SOURCE
 - 0) >= 700

354 
	#__USE_XOPEN2K8
 1

	)

355 
	#__USE_XOPEN2K8XSI
 1

	)

357 
	#__USE_XOPEN2K
 1

	)

358 
	#__USE_XOPEN2KXSI
 1

	)

359 #undeà
__USE_ISOC95


360 
	#__USE_ISOC95
 1

	)

361 #undeà
__USE_ISOC99


362 
	#__USE_ISOC99
 1

	)

365 #ifdeà
_XOPEN_SOURCE_EXTENDED


366 
	#__USE_XOPEN_EXTENDED
 1

	)

371 #ifdeà
_LARGEFILE_SOURCE


372 
	#__USE_LARGEFILE
 1

	)

375 #ifdeà
_LARGEFILE64_SOURCE


376 
	#__USE_LARGEFILE64
 1

	)

379 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

380 
	#__USE_FILE_OFFSET64
 1

	)

383 #ià
defšed
 
_DEFAULT_SOURCE


384 
	#__USE_MISC
 1

	)

387 #ifdef 
_ATFILE_SOURCE


388 
	#__USE_ATFILE
 1

	)

391 #ifdef 
_GNU_SOURCE


392 
	#__USE_GNU
 1

	)

395 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

396 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

397 #ià
_FORTIFY_SOURCE
 > 1

398 
	#__USE_FORTIFY_LEVEL
 2

	)

400 
	#__USE_FORTIFY_LEVEL
 1

	)

403 
	#__USE_FORTIFY_LEVEL
 0

	)

410 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


411 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

413 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

428 #ià(
defšed
 
__USE_GNU
 \

429 && (
defšed
 
	g__ılu¥lus
 \

430 ? (
	g__ılu¥lus
 < 201103L && !
defšed
 
	g__GXX_EXPERIMENTAL_CXX0X__
) \

431 : (!
defšed
 
__STDC_VERSION__
 || __STDC_VERSION__ < 199901L)))

432 
	#__GLIBC_USE_DEPRECATED_SCANF
 1

	)

434 
	#__GLIBC_USE_DEPRECATED_SCANF
 0

	)

439 
	~<¡dc-´edef.h
>

447 #undeà
__GNU_LIBRARY__


448 
	#__GNU_LIBRARY__
 6

	)

452 
	#__GLIBC__
 2

	)

453 
	#__GLIBC_MINOR__
 31

	)

455 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

456 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

459 #iâdeà
__ASSEMBLER__


460 #iâdeà
_SYS_CDEFS_H


461 
	~<sys/cdefs.h
>

466 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


467 
	#__USE_LARGEFILE
 1

	)

468 
	#__USE_LARGEFILE64
 1

	)

474 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

475 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

476 && 
defšed
 
	g__ex‹º_šlše


477 
	#__USE_EXTERN_INLINES
 1

	)

485 
	~<gnu/¡ubs.h
>

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

	@
1
.
1
/usr/include
16
345
Common/include/FreeRTOS.h
Common/include/common.h
Common/include/list.h
Common/include/queue.h
Common/src/list.c
Common/src/queue.c
Memory/include/heap.h
Memory/src/heap.c
Softtime/include/time.h
Softtime/src/time.c
kernel/main.c
schedule/include/task.h
schedule/src/task.c
/usr/include/time.h
/usr/include/features.h
/usr/include/stdc-predef.h
